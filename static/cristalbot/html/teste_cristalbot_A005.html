<!DOCTYPE html>
<html lang="pt-br">
<head>
	<title>CristalBot WEB</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
	  body { 
		margin: 0; 
		} 
	  .janelaCB {
		margin: 3px;
		/*background-color: #555555;*/
		width:98%;
	  }
	  .janelaCBx {
		background-color: rgba(00,00,00,0.8);
		/*
		background-color: #111111;
		Opacity: 50%;
		*/
		height:	0;
		width:100%;
		padding-bottom: 50%;
		color:#1111f1;
		text-align: center;
		position: absolute;
        top: 0px;
	  }
	  .janelaCBy {
		color:#1111f1;
		/*background-color: #111111;
		display: none;*/
	  }
	  #idInterface{
		font-size: 30px;
		color:#1111f1;
		text-align: center;
		position: absolute;
        top: 0px;
	  }
	  #divIntro1{
            /*
			background-color: #555555;   
            height: 100%;
            width: 100%;
            */
			background-image: url(/static/cristalbot/interface/equipamentos_eletricos.jpg);
            background-size: 100%;
			font-size: 25px;
      }
	  #divIntro2{
            /*
			background-color: #555555;   
            height: 100%;
            width: 100%;
            */
			background-image: url(/static/cristalbot/interface/projeto_cristalbot.jpg);
            background-size: 100%;
			font-size: 25px;
      }
	  #divMaquina{
		background-color: #000000;
	  }
	  .imgSom{
		width: 5%;
	  }
	  .imgPlanetColor{
		width: 15%;
		filter: none;
	  }
	  .imgPlanetCinza{
		width: 15%;
		filter: gray; /* IE6-9 */
		-webkit-filter: grayscale(100%); /* Chrome 19+, Safari 6+, Safari 6+ iOS */
	  }
	  .introImgCB{
		width: 50%;
	  }
	  .LogoImgCB{
		width: 25%;
	  }
	  /* center on top */
	</style>
</head>
<body>
	<script src="/static/assetsv5/js/three.min.js"></script>
	<script src="/static/assetsv5/js/GLTFLoader.js"></script>
	
	<div id="DivCanvasID"></div>

	<audio id="idAudioAmbiente"  src="/static/cristalbot/sons/TerrenoVenusCorte.m4a" loop>
		ERRO : Seu navegador nao suporta o elemento <code>audio</code>.
	</audio>
	<audio id="idAudioFX" src="/static/cristalbot/sons/VooDaNaveWav.mp3">
	</audio>


	<div id="idInterface">
			<div>
				<a id="myLink" href="#" onclick="abreJanela('idWinMenu');">Menu</a>
				<span id="idSpanPlaneta" >Total cristrais : 0</span>
			</div>
			<div>
				Joystick
			</div>		
			<div>
				<a href="#" onclick="somAtivo();">
					<img class="imgSom" src="/static/cristalbot/interface/Som.png" alt="Som - Liga/desliga">
				</a><br/>
				Planeta : <span id="idSpanPlaneta"></span>
			</div>
	</div>
	

	<div class="janelaCB" id="idWinMenu">
		<div class="janelaCBx janelaCBy">
			<p>
				<h1>Menu</h1><br>
				<img src="/static/cristalbot/interface/LogoCistalBot200x100.png" class="LogoImgCB" alt="CristalBot logo"><br/>
				<a id="idButInit" href="#" onclick="initAnimate();">Iniciar Jogo</a><br/>
				<a id="idButVoltar" href="#" onclick="fechaJanela('idWinMenu');">Voltar ao Jogo</a><br/>
				<a id="idButCredito" href="#" onclick="abreJanela('idWinCredito');">Credito</a><br/>
				<a id="idButPlaneta" href="#" onclick="abreJanela('idWinPlanetas');">Escolher Planeta</a><br/>
				<a id="idButLing" href="#" onclick="abreJanela('idWinCredito');">Switch to English</a><br/>
			</p>
		</div>
 	</div>

	 <div class="janelaCB" id="idWinLoad">
		<div class="janelaCBx janelaCBy">
			<p>
				<h1>Carregando...</h1><br>
				<img src="/static/cristalbot/interface/LogoCistalBot200x100.png" class="LogoImgCB" alt="CristalBot logo"><br/>
				Aguarde o termino do carregamento dos modelos e texturas do jogo.
			</p>
		</div>
 	</div>

	<div class="janelaCB" id="idWinCredito">
		<div class="janelaCBx janelaCBy">
		<p>
			<h2>Menu - Credito</h2><br>
			<img src="/static/cristalbot/interface/LogoCistalBot200x100.png" class="LogoImgCB" alt="CristalBot logo">
			<p>
				Cristal Bot é um game independente brasileiro, está na sua versão WEB.<br/>
				Esta versão foi desenvolvido integralçmente com JS, usando a biblioteca Three.js e modelagem 3D no Blender<br/>
				A primeira versão foi desenvolvida na plataforma Unity com linguage C#.<br/>
				Autor, desenvolvedor e modelagem : Vinícoius Valente Coutinho.<br/>
			</p>
			<a id="myLink" href="#" onclick="fechaJanela('idWinCredito');">Voltar para menu</a>
		</p></div>
 	</div>

	<div class="janelaCB" id="idWinPlanetas">
		<div class="janelaCBx janelaCBy">
		<h2>Menu - Planetas</h2><br>
		<a href="#" onclick="trocaPlaneta('Lua');"><img class="imgPlanetColor" src="/static/cristalbot/interface/FotoLua.jpg" alt="Foto Lua">Lua</a>
		<a href="#" onclick="trocaPlaneta('Marte');"><img class="imgPlanetColor" src="/static/cristalbot/interface/FotoMarte.jpg" alt="Foto Marte">Marte</a>
		<a href="#" onclick="trocaPlaneta('Mercurio');"><img class="imgPlanetCinza" src="/static/cristalbot/interface/FotoMercurio.jpg" alt="Foto Mercurio">Mercurio</a>
		<a href="#" onclick="trocaPlaneta('Plutao');"><img class="imgPlanetCinza" src="/static/cristalbot/interface/FotoPlutao.jpg" alt="Foto Plutao">Plutao</a>
		<a href="#" onclick="trocaPlaneta('Venus');"><img class="imgPlanetCinza" src="/static/cristalbot/interface/FotoVenus.jpg" alt="Foto Venus">Venus</a>
		<a id="myLink" href="#" onclick="fechaJanela('idWinPlanetas');">Voltar para menu</a>
	</div></div>
	
	<div class="janelaCB" id="idWinIntro2">
		<div class="janelaCBx janelaCBy" id="divIntro2">
		<p>
			<h1>Introducao</h1><br>
			A solucao e a estracao de energia de minarios espaciais.<br/>
			A extração de minério será feita por robos<br/>
			<a id="myLink" href="#" onclick="fechaJanela('idWinIntro2');">Continuar</a>
		</p></div>
 	</div>



	<div class="janelaCB" id="idWinIntro1">
		<div class="janelaCBx janelaCBy" id="divIntro1">
			<p>
				<br/>
				<h1>Introducao</h1><br>
				A umanidade precisa cada vez mais de energia.<br/>
				A busca por energia, nos levou a extração de minérios, em outros planetas<br/>
				<a id="myLink" href="#" onclick="fechaJanela('idWinIntro1');">Continuar</a>
			</p>
		</div>
 	</div>


	<div class="janelaCB" id="idWinMaquina">
		<div class="janelaCBx" id="divMaquina">
			<p>
			<br/>
			<img src="/static/cristalbot/interface/LogoCistalBot200x100.png" class="LogoImgCB" alt="CristalBot logo">
			<br/>
			Qual o equipamento que vc está usando?<br>
			<a id="myLink" href="#" onclick="funWinMaquina('pc', false);">Jogar no Computador</a> |
			<a id="myLink" href="#" onclick="funWinMaquina('pc', false);">Debugar no Computador</a><br/>
			<a id="myLink" href="#" onclick="funWinMaquina('pc', false);">Jogar no Celular</a> |
			<a id="myLink" href="#" onclick="funWinMaquina('pc', false);">Debugar no Celular</a>
			</p>
		</div>
	</div>

<script>

var renderer; //= new THREE.WebGLRenderer();
var x,  y, scene;
var listObjEmCena=[];
const pixel3d=10;
var largura//=window.innerWidth;
var altura//=window.innerHeight;
var camera
var cristaisNave = [];
var cristaisRobo = [];
var groupNaveMae
var groupRobo
var Converes = [];
var baterias = [];
var totalCarga = 0;
var materialLua, materialMarte, materialMercurio, materialPlutao, materialVenus, materialRobo, materialBarrinhaA, materialBarrinhaB;
var materialCristal = [];
var materialCeu = [];
var dados;
var solidosPlator = [];
var LinksPlator = [];
var debugging = true;
var fundCeu
var PlanetaAtual = ""; //"Lua"
var TerrenoLua, TerrenoMarte, TerrenoMercurio, TerrenoPlutao, TerrenoVenus
var stateArm=0;
var stateDirecao="";
var rodasRobo = [];
var energiaRobo, energiaRobo2
var anguloRoda=0
var groupNave;
var garraRobo
var groupBracoRobo
var bracoRobo
var platorAtual=0;
var objPortaNave;
var statePortaAberta = false;
var stareNave = 0 //(1=subindo, 0=parada, -1=descendo)
var NaGarra = "";
var NaGarraCristal = 0;
var objCristal = [];
var idAudioAmbiente;
var idAudioFX;
var varSomAtivo = true;
var luz;
var rumGame = false;

function funDadosSolid(TempPlator){
	console.log("funDadosSolid("+TempPlator+")");
	let solid=[];
  	let a=0;
	if(TempPlator==1){
		//=Terreno=3=====================================================
		solid[a++]={width:20,  height:200, depth:1400,x:-735,y:-105,z:1463} // limite Lado
		solid[a++]={width:20,  height:200, depth:1400,x:798, y:-105,z:1463} // limite lado
		solid[a++]={width:1600,height:200, depth:20,  x:10,  y:-105,z:752} // limite fundo
		solid[a++]={width:1600,height:150, depth:20,  x:10,  y:-105,z:2082} // limite frente
		solid[a++]={width:150, height:50,  depth:130, x:-707,y:-105,z:1711} // cratera plator1
		solid[a++]={width:450, height:100, depth:450, x:-567,y:-105,z:780} //(largura,altura,profundidade)  pedra plator1
		solid[a++]={width:450, height:100, depth:450, x:623, y:-105,z:794} //(largura,altura,profundidade)  pedra plator1
		//=Nave=========================================================
		solid[a++]={width:20,  height:100, depth:178, x:-252,y:-80, z:1220} // Nave Parede esquerda
		solid[a++]={width:20,  height:100, depth:178, x:273, y:-80, z:1220} // Nave Parede direita
		solid[a++]={width:170, height:100, depth:20,  x:-168,y:-80, z:1095} // Nave paredes 
		solid[a++]={width:185, height:100, depth:20,  x:189, y:-80, z:1088} // Nave paredes
		solid[a++]={width:200, height:100, depth:20,  x:-168,y:-80, z:1291} // Nave paredes 
		solid[a++]={width:200, height:100, depth:20,  x:189, y:-80, z:1291} // Nave paredes
		//=Nave=Cabine====================================================
		solid[a++]={width:20,  height:100, depth:178, x:-91, y:-80, z:1011} // Nave Parede cabine
		solid[a++]={width:20,  height:100, depth:178, x:98,  y:-80, z:1011} // Nave Parede cabine
		solid[a++]={width:160, height:100, depth:20,  x:0,   y:-80, z:885}  // Nave cabine fundo

	}else if(TempPlator==2){
		//=Terreno=3=====================================================
		solid[a++]={width:20,  height:200, depth:1400,x:-735,y:5,z:63}   // limite Lado
		solid[a++]={width:20,  height:200, depth:1400,x:798, y:5,z:63}   // limite lado
		solid[a++]={width:1600,height:200, depth:20,  x:10,  y:5,z:-565} // limite fundo
		solid[a++]={width:1600,height:150, depth:20,  x:10,  y:5,z:695}  // limite frente
		solid[a++]={width:150, height:50, depth:130, x:-675, y:5,z:-601} // cratera plator 2 x=-675,y=85,z=-601
		solid[a++]={width:150, height:50, depth:130, x:489, y:5,z:-556}  // cratera plator 2 x=489,y=124,z=-556
		let tepDif = 1250
		//=Nave=========================================================
		solid[a++]={width:20,  height:100, depth:178, x:-252,y:5, z:1220-tepDif} // Nave Parede esquerda
		solid[a++]={width:20,  height:100, depth:178, x:273, y:5, z:1220-tepDif} // Nave Parede direita
		solid[a++]={width:170, height:100, depth:20,  x:-168,y:5, z:1095-tepDif} // Nave paredes 
		solid[a++]={width:185, height:100, depth:20,  x:189, y:5, z:1088-tepDif} // Nave paredes
		solid[a++]={width:200, height:100, depth:20,  x:-168,y:5, z:1291-tepDif} // Nave paredes 
		solid[a++]={width:200, height:100, depth:20,  x:189, y:5, z:1291-tepDif} // Nave paredes
		//=Nave=Cabine====================================================
		solid[a++]={width:20,  height:100, depth:178, x:-91, y:5, z:1011-tepDif} // Nave Parede cabine
		solid[a++]={width:20,  height:100, depth:178, x:98,  y:5, z:1011-tepDif} // Nave Parede cabine
		solid[a++]={width:160, height:100, depth:20,  x:0,   y:5, z:885-tepDif}  // Nave cabine fundo

	}else if(TempPlator==3){
		//=Terreno=3=====================================================
		solid[a++]={width:20,  height:200, depth:1400,x:-650,y:-105,z:-1337}   // limite Lado
		solid[a++]={width:20,  height:200, depth:1400,x:700, y:-105,z:-1337}   // limite lado
		solid[a++]={width:1600,height:200, depth:20,  x:29,  y:-105,z:-1964} // limite fundo //x=29,y=-110,z=-1964
		solid[a++]={width:1600,height:150, depth:20,  x:10,  y:-105,z:-705}  // limite frente
		solid[a++]={width:200, height:50, depth:200, x:-575, y:-105,z:-2001} // cratera plator 2 x=-675,y=85,z=-601
		solid[a++]={width:550, height:50, depth:250, x:589,  y:-105,z:-1956}  // cratera plator 2 x=489,y=124,z=-556	
		let tepDif = 2460
		//=Nave=========================================================
		solid[a++]={width:20,  height:100, depth:178, x:-252,y:-105, z:-1240} // Nave Parede esquerda
		solid[a++]={width:20,  height:100, depth:178, x:273, y:-105, z:-1240} // Nave Parede direita
		solid[a++]={width:170, height:100, depth:20,  x:-168,y:-105, z:-2460} // Nave paredes 
		solid[a++]={width:185, height:100, depth:20,  x:189, y:-105, z:1088-tepDif} // Nave paredes
		solid[a++]={width:200, height:100, depth:20,  x:-168,y:-105, z:1291-tepDif} // Nave paredes 
		solid[a++]={width:200, height:100, depth:20,  x:189, y:-105, z:1291-tepDif} // Nave paredes
		//=Nave=Cabine====================================================
		solid[a++]={width:20,  height:100, depth:178, x:-91, y:-105, z:-1449} // Nave Parede cabine
		solid[a++]={width:20,  height:100, depth:178, x:98,  y:-105, z:-1449} // Nave Parede cabine
		solid[a++]={width:160, height:100, depth:20,  x:0,   y:-105, z:-1575}  // Nave cabine fundo

	}
	return solid;
}


function funDadosLinks(TempPlator){idWinMaquina
	console.log("funDadosLinks("+TempPlator+")");
	let links=[];
  	let a=0;
	if(TempPlator==1){
		links[a++]={width:30,  height:100, depth:30,  x:0,   y:-91, z:1004,action:"cabine",state:"on"} // Cabine recarregar
		//=Geradores=========================================================
		links[a++]={width:70,  height:100, depth:80, x:-224, y:-91, z:1240,action:"gerador",state:"0"} // Conversores 3
		//=Furadeira=========================================================
		links[a++]={width:30,  height:100, depth:30,  x:-200,  y:-80, z:1155,action:"furadeira",state:"on"} // estoque1
		//=estoque===========================================================
		links[a++]={width:70,  height:100, depth:160, x:224, y:-91, z:1190,action:"estoque",state:"on"} // estoque1
		//=Cristais==========================================================
		links[a++]={width:40,  height:100, depth:40,x:dados.mina[1][0].x, y:dados.mina[1][0].y,z:dados.mina[1][0].z,action:"mina1"} // cristal 1
		links[a++]={width:40,  height:100, depth:40,x:dados.mina[1][1].x, y:dados.mina[1][1].y,z:dados.mina[1][1].z,action:"mina2"} // cristal 2
		links[a++]={width:40,  height:100, depth:40,x:dados.mina[1][2].x, y:dados.mina[1][2].y,z:dados.mina[1][2].z,action:"mina3"} // cristal 3
		links[a++]={width:40,  height:100, depth:40,x:dados.mina[1][3].x, y:dados.mina[1][3].y,z:dados.mina[1][3].z,action:"mina4"} // cristal 4
		links[a++]={width:40,  height:100, depth:40,x:dados.mina[1][4].x, y:dados.mina[1][4].y,z:dados.mina[1][4].z,action:"mina5"} // cristal 5
		//=Rampa=============================================================
		links[a++]={width:150, height:100, depth:30, x:0,  y:-91,  z:1290,action:"rampa1",state:"on"}  //rampa sobe x=0,y=-112,z=1277
		links[a++]={width:100, height:100, depth:100,x:-153,y:-106,z:1362,action:"rampa3",state:"on"}  //rampa desce x=0,y=-112,z=1368
		links[a++]={width:100, height:100, depth:100,x:153, y:-106,z:1362,action:"rampa3",state:"on"}  //rampa desce x=0,y=-112,z=1368
		links[a++]={width:200, height:100, depth:30, x:0,   y:-91,z:1362, action:"rampa3",state:"on"}  //rampa desce x=0,y=-112,z=1368
	}else if(TempPlator==2){
		let tepDif = 1255

		links[a++]={width:30,  height:100, depth:30,  x:0,   y:-5, z:1004-tepDif,action:"cabine",state:"on"} // Cabine recarregar
		//=Geradores=========================================================
		links[a++]={width:70,  height:100, depth:80, x:-224, y:-5, z:1240-tepDif,action:"gerador",state:"0"} // Conversores 3
		//=Furadeira=========================================================
		links[a++]={width:30,  height:100, depth:30,  x:-200,  y:-5, z:1155-tepDif,action:"furadeira",state:"on"} // estoque1
		//=estoque===========================================================
		links[a++]={width:70,  height:100, depth:160, x:224, y:-5, z:1190-tepDif,action:"estoque",state:"on"} // estoque1
		//=cristais=========================================================
		links[a++]={width:40,  height:100, depth:40,x:dados.mina[2][0].x,y:dados.mina[2][0].y,z:dados.mina[2][0].z,action:"mina1"} // cristal 1
		links[a++]={width:40,  height:100, depth:40,x:dados.mina[2][1].x,y:dados.mina[2][1].y,z:dados.mina[2][1].z,action:"mina2"} // cristal 2
		links[a++]={width:40,  height:100, depth:40,x:dados.mina[2][2].x,y:dados.mina[2][2].y,z:dados.mina[2][2].z,action:"mina3"} // cristal 3
		links[a++]={width:40,  height:100, depth:40,x:dados.mina[2][3].x,y:dados.mina[2][3].y,z:dados.mina[2][3].z,action:"mina4"} // cristal 4
		links[a++]={width:40,  height:100, depth:40,x:dados.mina[2][4].x,y:dados.mina[2][4].y,z:dados.mina[2][4].z,action:"mina5"} // cristal 5
		//=rampa============================================================
		links[a++]={width:150, height:100, depth:30, x:-14, y:5, z:-10,action:"rampa1",state:"on"}  //sobe x=0,y=-112,z=1277
		links[a++]={width:100, height:100, depth:100,x:-153,y:5, z:62, action:"rampa3",state:"on"}  //rampa desce x=0,y=-112,z=1368
		links[a++]={width:100, height:100, depth:100,x:153, y:5, z:62, action:"rampa3",state:"on"}  //rampa desce x=0,y=-112,z=1368
		links[a++]={width:200, height:100, depth:30, x:0,   y:5, z:62, action:"rampa3",state:"on"}  //rampa desce x=0,y=-112,z=1368
		//=Rampa=============================================================
		links[a++]={width:150, height:100, depth:30, x:0,  y:-91,  z:1290, action:"rampa1",state:"on"}  //rampa sobe x=0,y=-112,z=1277
		links[a++]={width:100, height:100, depth:100,x:-153,y:-106,z:1362, action:"rampa3",state:"on"}  //rampa desce x=0,y=-112,z=1368
		links[a++]={width:100, height:100, depth:100,x:153, y:-106,z:1362, action:"rampa3",state:"on"}  //rampa desce x=0,y=-112,z=1368
		links[a++]={width:200, height:100, depth:30, x:0,   y:-91, z:1362, action:"rampa3",state:"on"}  //rampa desce x=0,y=-112,z=1368
	}else if(TempPlator==3){
		let tepDif = 2490;
		links[a++]={width:30,  height:100, depth:30,  x:0,   y:-91, z:1004-tepDif ,action:"cabine",state:"on"} // Cabine recarregar
		//=Geradores=========================================================
		links[a++]={width:70,  height:100, depth:80, x:-224, y:-91, z:1240-tepDif ,action:"gerador",state:"0"} // Conversores 3
		//=Furadeira=========================================================
		links[a++]={width:30,  height:100, depth:30,  x:-200,  y:-80, z:1155-tepDif ,action:"furadeira",state:"on"} // estoque1
		//=estoque===========================================================
		links[a++]={width:70,  height:100, depth:160, x:224, y:-91, z:1190-tepDif ,action:"estoque",state:"on"} // estoque1
		//=cristais=========================================================
		links[a++]={width:30,  height:100, depth:30,x:dados.mina[3][0].x,y:dados.mina[3][0].y,z:dados.mina[3][0].z,action:"mina1",state:"off"} // cristal 1
		links[a++]={width:30,  height:100, depth:30,x:dados.mina[3][1].x,y:dados.mina[3][1].y,z:dados.mina[3][1].z,action:"mina2",state:"off"} // cristal 2
		links[a++]={width:30,  height:100, depth:30,x:dados.mina[3][2].x,y:dados.mina[3][2].y,z:dados.mina[3][2].z,action:"mina3",state:"off"} // cristal 3
		links[a++]={width:30,  height:100, depth:30,x:dados.mina[3][3].x,y:dados.mina[3][3].y,z:dados.mina[3][3].z,action:"mina4",state:"off"} // cristal 4
		links[a++]={width:30,  height:100, depth:30,x:dados.mina[3][4].x,y:dados.mina[3][4].y,z:dados.mina[3][4].z,action:"mina5",state:"off"} // cristal 5
		//=Rampa=============================================================
		links[a++]={width:150, height:100, depth:30, x:0,   y:-91, z:1290-tepDif, action:"rampa1", state:"on"}  //rampa sobe x=0,y=-112,z=1277
		links[a++]={width:100, height:100, depth:100,x:-153,y:-106,z:1362-tepDif, action:"rampa3", state:"on"}  //rampa desce x=0,y=-112,z=1368
		links[a++]={width:100, height:100, depth:100,x:153, y:-106,z:1362-tepDif, action:"rampa3", state:"on"}  //rampa desce x=0,y=-112,z=1368
		links[a++]={width:200, height:100, depth:30, x:0,   y:-91, z:1362-tepDif, action:"rampa3", state:"on"}  //rampa desce x=0,y=-112,z=1368
	}
	return links;
}


function funDadosMina(){
	console.log("funDadosMina()");
	let tepDi2 = 1270;
	let tepDif3 = 2445;
	let TempMina=[
		[
			{x:0, y:0, z:0}
		],[
			{x:-532, y:-91, z:1557, state:"off"},
			{x:-455, y:-91, z:1872, state:"off"},
			{x: 574, y:-91, z:1557, state:"off"},
			{x: 518, y:-91, z:1837, state:"off"},
			{x: -14, y:-91, z:1935, state:"off"}
		],[
			{x:-532, y:-30, z:1557-tepDi2, state:"off"},
			{x:-455, y:-30, z:1872-tepDi2, state:"off"},
			{x: 574, y:-30, z:1557-tepDi2, state:"off"},
			{x: 518, y:-30, z:1837-tepDi2, state:"off"},
			{x: -14, y:-30, z:1935-tepDi2, state:"off"}
		],[
			{x:-532, y:-91, z:1557-tepDif3, state:"off"},
			{x:-455, y:-91, z:1872-tepDif3, state:"off"},
			{x: 574, y:-91, z:1557-tepDif3, state:"off"},
			{x: 518, y:-91, z:1837-tepDif3, state:"off"},
			{x: -14, y:-91, z:1935-tepDif3, state:"off"}
		]
	]
	return TempMina;
}



//=Interface====================================================================================

function fechaJanela(tempWin) {
	if(tempWin=="idWinMaquina"){
		idWinIntro1.style.display = "block"; // Mostrar janela intro1.
		//idInterface.style.display = "none"; // esconder
		idWinMaquina.style.display = "none"; // esconder
		idWinIntro2.style.display = "none"; // esconder Janela de Introducao 2.
		idWinPlanetas.style.display = "none"; // esconder menu planetas.
		idWinCredito.style.display = "none"; // esconder menu de credito.
		idWinMenu.style.display = "none"; // esconder menu principal.
		//idWinLoad.style.display = "none"; // esconder janela de carregando.
	}else if(tempWin=="idWinIntro1"){
		idWinIntro1.style.display = "none"; // esconder Janela de Introducao 1.
        idWinIntro2.style.display = "block"; // Mostrar Janela de Introducao 3.
	}else if(tempWin=="idWinIntro2"){
		idWinIntro2.style.display = "none"; // esconder Janela de Introducao 2.
		idButInit.style.display = "block"; // Mostrar butao iniciar jogo
		idButVoltar.style.display = "none"; // esconder butao voltar ao jogo
		if(totalCarga>=5){
			//terminou de carregar todos modelos, pode continuar.
			idWinMenu.style.display = "block"; // Mostrar menuprincipal.
			idWinLoad.style.display = "none"; // esconder Janela de Introducao 2.
		}else{
			idWinLoad.style.display = "block"; // Mostrar janela carregando.
		}
	}else if(tempWin=="idWinPlanetas"){
		idWinPlanetas.style.display = "none"; // esconder menu planetas.
    	idWinMenu.style.display = "block"; // Mostrar menuprincipal.
	}else if(tempWin=="idWinCredito"){
		idWinCredito.style.display = "none"; // esconder menu de planetas.
    	idWinMenu.style.display = "block"; // Mostrar menu principal.
	}else if(tempWin=="idWinMenu"){
		idWinMenu.style.display = "none"; // esconder menu principal.
		idWinPlanetas.style.display = "none"; // esconder menu planetas.
		//idInterface.style.display = "block"; // Mostrar interface do jogo.
		rumGame=true; // Dar PLAY no jogo.
	}else{
		idInterface.style.display = "none"; // esconder
		idWinMaquina.style.display = "none"; // esconder
		idWinIntro1.style.display = "none"; // esconder Janela de Introducao 1.
		idWinIntro2.style.display = "none"; // esconder Janela de Introducao 2.
		idWinPlanetas.style.display = "none"; // esconder menu planetas.
		idWinCredito.style.display = "none"; // esconder menu de credito.
		idWinMenu.style.display = "none"; // esconder menu principal.
	}
}

function abreJanela(tempWin) {
	if(tempWin=="idWinIntro1"){
        idWinIntro2.style.display = "block"; // Mostrar Janela de Introducao 3.
	}else if(tempWin=="idWinPlanetas"){
		idWinPlanetas.style.display = "block"; // Mostrar menu planetas.
	}else if(tempWin=="idWinCredito"){
		idWinCredito.style.display = "block"; // mostrar Janela de creditos.
	}else if(tempWin=="idWinMenu"){
		idWinMenu.style.display = "block"; // mostrar menu principal.
		rumGame=false; // Pausar jogo
	}
}

var varMaquina = "pc";

function funWinMaquina(temMaquina, temDebug){
	//temMaquina = "pc", "mobile"
	//temDebug = true, false 
	if(temMaquina!=="pc"){
			varMaquina="mobile";
    }
	if(temDebug){
		debugging = true;
	}else{
		debugging = false;
	}
	init();
	fechaJanela("idWinMaquina");
	//fechaJanela("todos");
}


function somAtivo(){
	if(varSomAtivo){
		varSomAtivo=false;
		idAudioAmbiente.pause();
		idAudioFX.pause();
	}else{
		varSomAtivo=true;
		idAudioAmbiente.play();
		funSound(2,"cristal.m4a"); // Tocar uma mbarulinho cristal.
	}
}

function funSound(numSom, varSom){
	console.log("funSound("+numSom+","+varSom+")")
	if(varSomAtivo){
		// Tocar som.
		if(numSom==1){
		//-Som-ambiente---------------------------------
		//TerrenoVenusCorte.m4a e vento.mp3
		idAudioAmbiente.src="/static/cristalbot/sons/"+varSom;
    	idAudioAmbiente.play();
		}else{
			//-Som-efeitos---------------------------------
			// cristal.m4a semBateria.wav porta_nave.wav  MeteoroBateu.mp3 
			idAudioFX.src="/static/cristalbot/sons/"+varSom;
			idAudioFX.play();
		}
    }
}



function initMaterial(){
	const loader = new THREE.TextureLoader();
	//const urlImgTexture = loader.load('https://vvcestudio.vercel.app/static/assetsv5/img/design/3D-06.jpg');
	//textura nave
	const urlImgTexture = loader.load('https://st3.depositphotos.com/30440304/i/600/depositphotos_343055824-stock-photo-seamless-scifi-panels-futuristic-texture.jpg');
    const urlImgTextureSoloMarte = loader.load('/static/cristalbot/texturas/textSoloMartRelevo.jpg');
	const urlImgTextureSoloLua = loader.load('/static/cristalbot/texturas/textSoloLuaRelevo.jpg');	
	const urlImgTextureSoloVenus = loader.load('/static/cristalbot/texturas/GameTexturaMagma1.jpg');
	const urlImgTextureSoloVenusLuz = loader.load('/static/cristalbot/texturas/GameTexturaMagmaLuz1.jpg');
	
	const urlImgTextureRobo = loader.load('/static/cristalbot/texturas/GameTexturaNave3_espelho.jpg');
	const urlImgTextureRoboBump = loader.load('/static/cristalbot/texturas/GameTexturaNaveBump2.jpg');
	const urlImgTextureRoboLuz = loader.load('/static/cristalbot/texturas/GameTexturaNaveLuz_2.jpg');

	// Cristais
	const urlImgTextureCistalA = loader.load('/static/cristalbot/texturas/texturaCistalA2.jpg');
	const urlImgTextureCistalB = loader.load('/static/cristalbot/texturas/texturaCistalB2.jpg');
	const urlImgTextureCistalC = loader.load('/static/cristalbot/texturas/texturaCistalC2.jpg');
	const urlImgTextureCistalD = loader.load('/static/cristalbot/texturas/texturaCistalD2.jpg');
	const urlImgTextureCistalE = loader.load('/static/cristalbot/texturas/texturaCistalE2.jpg');

	// sprits explosao
	const urlImgExplosao1 = loader.load('/static/cristalbot/texturas/explosao_001.png'); // Explosao
	const urlImgExplosao2 = loader.load('/static/cristalbot/texturas/explosao_002.png'); // Explosao
	const urlImgExplosao3 = loader.load('/static/cristalbot/texturas/explosao_003.png'); // Explosao
	const urlImgExplosao4 = loader.load('/static/cristalbot/texturas/explosao_004.png'); // Explosao
	const urlImgExplosao5 = loader.load('/static/cristalbot/texturas/explosao_005.png'); // Explosao
	const urlImgExplosao6 = loader.load('/static/cristalbot/texturas/explosao_006.png'); // Explosao
	
	// sprits Magia
	const urlImgMagia1 = loader.load('/static/cristalbot/texturas/magiacristal01.png'); // Magia
	const urlImgMagia2 = loader.load('/static/cristalbot/texturas/magiacristal02.png'); // Magia
	const urlImgMagia3 = loader.load('/static/cristalbot/texturas/magiacristal03.png'); // Magia
	const urlImgMagia4 = loader.load('/static/cristalbot/texturas/magiacristal04.png'); // Magia
	const urlImgMagia5 = loader.load('/static/cristalbot/texturas/magiacristal05.png'); // Magia

	// sprits - 	"Lua", "Marte", "Mercurio", "Plutao", "Venus"
	const urlImgCeuLua = loader.load('/static/cristalbot/texturas/ceu_lua.jpg'); // ceu Sprit
	const urlImgCeuMarte = loader.load('/static/cristalbot/texturas/ceu_marte.jpg'); // ceu Sprit
	const urlImgCeuMercurio = loader.load('/static/cristalbot/texturas/ceu_mercurio.jpg'); // ceu Sprit
	const urlImgCeuPlutao = loader.load('/static/cristalbot/texturas/ceu_plutao.jpg'); // ceu Sprit
	const urlImgCeuVenus = loader.load('/static/cristalbot/texturas/ceu_venus.jpg'); // ceu Sprit

	// Sprites
	const urlImgGameOver = loader.load('/static/cristalbot/texturas/game_over.png'); // Fim de Jogo
	const urlImgBarrinhaContorno = loader.load('/static/cristalbot/texturas/barrinha_contono.png'); // Fim de Jogo
	const urlImgBarrinhaCarga = loader.load('/static/cristalbot/texturas/barrinha_carga.png'); // Fim de Jogo


	materialCristal[0]= new THREE.MeshPhongMaterial( { 
		map: urlImgTextureCistalA,
		color: 0xffffff
	 } ); // Cistal A
	materialCristal[1]= new THREE.MeshPhongMaterial( { 
		map: urlImgTextureCistalB,
		color: 0xffffff
	 } ); // Cistal B
	materialCristal[2]= new THREE.MeshPhongMaterial( { 
		map: urlImgTextureCistalC,
		color: 0xffffff
	 } ); // Cistal C
	materialCristal[3]= new THREE.MeshPhongMaterial( { 
		map: urlImgTextureCistalD,
		color: 0xffffff
	 } ); // Cistal D
	materialCristal[4]= new THREE.MeshPhongMaterial( { 
		map: urlImgTextureCistalE,
		color: 0xffffff
	 } ); // Cistal E

	/*
	materialCeu[0] = new THREE.MeshBasicMaterial( { map: urlImgCeuLua, color: 0xffffff } ); // Ceu
	materialCeu[1] = new THREE.MeshBasicMaterial( { map: urlImgCeuMarte, color: 0xffffff } ); // Ceu
	materialCeu[2] = new THREE.MeshBasicMaterial( { map: urlImgCeuMercurio, color: 0xffffff } ); // Ceu
	materialCeu[3] = new THREE.MeshBasicMaterial( { map: urlImgCeuPlutao, color: 0xffffff } ); // Ceu
	materialCeu[4] = new THREE.MeshBasicMaterial( { map: urlImgCeuVenus, color: 0xffffff } ); // Ceu
	*/
	   materialCeu[0] = new THREE.SpriteMaterial( { map: urlImgCeuLua, color: 0xffffff } ); // Ceu
	   materialCeu[1] = new THREE.SpriteMaterial( { map: urlImgCeuMarte, color: 0xffffff } ); // Ceu
	   materialCeu[2] = new THREE.SpriteMaterial( { map: urlImgCeuMercurio, color: 0xffffff } ); // Ceu
	   materialCeu[3] = new THREE.SpriteMaterial( { map: urlImgCeuPlutao, color: 0xffffff } ); // Ceu
	   materialCeu[4] = new THREE.SpriteMaterial( { map: urlImgCeuVenus, color: 0xffffff } ); // Ceu
	materialBarrinhaA = new THREE.SpriteMaterial( { map: urlImgBarrinhaContorno, color: 0x0000ff } ); // Energia
	materialBarrinhaB = new THREE.SpriteMaterial( { map: urlImgBarrinhaCarga, color: 0x0000ff } ); // Energia

	//color: 0x999999,
	materialLua = new THREE.MeshPhongMaterial({	
		map: urlImgTextureSoloLua,
		bumpMap: urlImgTextureSoloLua
	}); // Textura da rua e do terreo.
	materialLua.bumpScale=0.9; // Efeito profundidade de textura
	materialLua.shininess =1; // Brilho minimo.

	materialMarte = new THREE.MeshPhongMaterial({
		map: urlImgTextureSoloMarte,
		bumpMap: urlImgTextureSoloMarte
	}); 
	materialMarte.bumpScale=0.3; // Efeito profundidade de textura
	materialMarte.shininess = 1; // Brilho minimo.

	materialMercurio = new THREE.MeshPhongMaterial({
		color: 0x999999,
		bumpMap: urlImgTextureSoloLua
	}); 
	materialMercurio.bumpScale=0.9; // Efeito profundidade de textura
	materialMercurio.shininess = 2; // Brilho minimo.

	materialPlutao = new THREE.MeshPhongMaterial({
		color: 0x808099,
		bumpMap: urlImgTextureSoloMarte
	}); 
	materialPlutao.bumpScale=0.5; // Efeito profundidade de textura
	materialPlutao.shininess = 15; // Brilho minimo.

	materialVenus = new THREE.MeshPhongMaterial({
		color: 0x808099,
		map: urlImgTextureSoloVenus,
		bumpMap: urlImgTextureSoloVenus,
		emissiveMap: urlImgTextureSoloVenusLuz,
		specular: 0xffffff,
		emissive: 0x550000,
	});
	materialVenus.bumpScale=0.5; // Efeito profundidade de textura
	materialVenus.shininess = 1; // Brilho minimo.

	materialRobo = new THREE.MeshPhongMaterial({ 
		color: 0xffffff,
		map: urlImgTextureRobo,
		bumpMap: urlImgTextureRoboBump,
		specular: 0x010101,
		emissive: 0xffffff,
		emissiveMap: urlImgTextureRoboLuz
	}); 
	materialRobo.bumpScale=0.3; // intencidade do profundidade
	materialRobo.shininess=100; // Brilho máximo.

	//emissiveMap = urlImgTextureRoboLuz
	//lightMap = urlImgTextureRoboLuz
	//specularMap ?
	//emissive ?
	//aoMap: urlImgTextureRoboLuz
	//map: urlImgTextureRobo,
	//bumpMap: urlImgTextureRoboBump,
	//displacementMap
	//	
	//materialRobo.emissiveIntensity = 1// Intensity of the emissive light. Modulates the emissive color. Default is 1.
	//materialRobo.lightMapIntensity = 100; // Intensity do mapa de  luz. Default is 1.
	//materialRobo.aoMapIntensity = 0.5;
			
  }



function initLight(){
	//castShadow
	//Se definido como true, lancara sombras dinamicas.
	//Aviso: Isso e caro e requer ajustes para que as sombras parecam corretas.
	//Consulte o DirectionalLightShadow para obter detalhes.
	//O padrao e falso.
	luz = {nave:[], Lua:[], Marte:[], Mercurio:[], Plutao:[], Venus:[]};

	luz.nave[0] = new THREE.PointLight( 0x9999ff, 1, 1000 ); // Cria Luz
	luz.nave[0].position.x = 0;
	luz.nave[0].position.y = 0;
	luz.nave[0].position.z = 0;
	scene.add(luz.nave[0]);
	luz.nave[1] = new THREE.PointLight( 0x9999ff, 1, 1000 ); // Cria Luz
	luz.nave[1].position.x = 0;
	luz.nave[1].position.y = 0;
	luz.nave[1].position.z = 0;
	scene.add(luz.nave[1]);

	//=Criar=luz=da=Lua=======================================================
	luz.Lua[0] = new THREE.AmbientLight( 0xffffff, 0.2) //luz AMBIENTE lua.
	
	luz.Lua[1] = new THREE.DirectionalLight( 0xffffff, 1.3 ); //Criar Luz direcional Lua (color, intensity)
	luz.Lua[1].position.x = 500;
	luz.Lua[1].position.y = 150;
	luz.Lua[1].position.z = 100;
	luz.Lua[1].castShadow = true // Abilitar as sombra
	//luz1.shadow.mapSize.width = 1500;
	//luz1.shadow.mapSize.height = 1500;
	//luz1.shadow.camera.near = 0.0;
	//luz1.shadow.camera.far = 1000;
	
	luz.Lua[2] = new THREE.DirectionalLightHelper( luz.Lua[1], 500 ); //Criar um helper da luz da Lua.
	//const helperLuz = new THREE.CameraHelper(luz1.shadow.camera) // Helper da sombra

	//=Criar=luz=de=Marte======================================================
	luz.Marte[0] = new THREE.AmbientLight( 0xdfa9ff, 0.2) //luz AMBIENTE marte.

	luz.Marte[1] = new THREE.DirectionalLight( 0xdfa957, 1.2 ); //criar Luz direcional Marte (color, intensity)
	luz.Marte[1].position.x = -500;
	luz.Marte[1].position.y = 250;
	luz.Marte[1].position.z = 100;
	luz.Marte[1].castShadow = true // Abilitar as sombra.
	
	luz.Marte[2] = new THREE.DirectionalLightHelper( luz.Marte[1], 500 ); //Criar um helper da luz da Marte.

	//=Criar=luz=de=Mercurio======================================================
	luz.Mercurio[0] = new THREE.AmbientLight( 0xffffff, 0.2) //luz AMBIENTE Mercurio.

	luz.Mercurio[1] = new THREE.DirectionalLight( 0xffffff, 1 ); //criar Luz direcional Mercurio (color, intensity)
	luz.Mercurio[1].position.x = -50;
	luz.Mercurio[1].position.y = 150;
	luz.Mercurio[1].position.z = -500;
	luz.Mercurio[1].castShadow = true // Abilitar as sombra.
	
	luz.Mercurio[2] = new THREE.DirectionalLightHelper( luz.Mercurio[1], 500 ); //Criar um helper da luz de Mercurio.

	//=Criar=luz=de=Plutao======================================================
	luz.Plutao[0] = new THREE.AmbientLight( 0x1010ff, 0.2) //luz AMBIENTE Plutao.

	luz.Plutao[1] = new THREE.DirectionalLight( 0xffff99, 2 ); //criar Luz direcional Plutao (color, intensity)
	luz.Plutao[1].position.x = 500;
	luz.Plutao[1].position.y = 150;
	luz.Plutao[1].position.z = -500;
	luz.Plutao[1].castShadow = true // Abilitar as sombra.

	luz.Plutao[2] = new THREE.DirectionalLightHelper( luz.Plutao[1], 500 ); //Criar um helper da luz de Plutao.


	//=Criar=luz=de=Venus======================================================
	luz.Venus[0] = new THREE.AmbientLight( 0xffffff, 0.2) //luz AMBIENTE Venus.

	luz.Venus[1] = new THREE.DirectionalLight( 0xff0000, 1 ); //criar Luz direcional Venus (color, intensity)
	luz.Venus[1].position.x = 500;
	luz.Venus[1].position.y = -500;
	luz.Venus[1].position.z = 500;
	luz.Venus[1].castShadow = true // Abilitar as sombra.

	luz.Venus[2] = new THREE.DirectionalLightHelper( luz.Venus[1], 500 ); //Criar um helper da luz de Plutao.


}


function initCamera(){
	// Camera
	camera = new THREE.PerspectiveCamera( 50, largura / altura, 1, pixel3d*1000 ); //(fov, aspect, ner, distante);
	scene.add(camera);
	/*
	// Camera corrida
	camera.position.x = 0;
	camera.position.y = 40;
	camera.position.z = 180;
	camera.lookAt(0, 70, 0);	//camera.lookAt(2, 9,-21);
	// Criar um target para a camera. controls.target.set()
	*/
	// Camera robo
	camera.position.x = -80;
	camera.position.y = 80;
	camera.position.z = 280;
	camera.lookAt(0, 0, 0);
	// Criar um target para a camera. controls.target.set()
}


//var groupBlocos = new THREE.Group();
var listlinksEmCena=[];

function gerandoBlocos() {
    if(debugging){
		for (let i = 0; i < listObjEmCena.length ; i++ ) {
			scene.remove(listObjEmCena[i]);
		}
		for (let i = 0; i < listlinksEmCena.length ; i++ ) {
			scene.remove(listlinksEmCena[i]);
		}

		console.log("criando solido e links");
		let geometry=[];
		let geometry2=[];
		for (let i = 0; i < dados.solid.length ; i++ ) {
			geometry[i] = new THREE.BoxGeometry(dados.solid[i].width,dados.solid[i].height,dados.solid[i].depth); //(largura,altura,profundidade) Parede esquerda
			listObjEmCena[i] = new THREE.Mesh( geometry[i], materialCristal[0] );
			listObjEmCena[i].position.x= dados.solid[i].x;
			listObjEmCena[i].position.y= dados.solid[i].y;
			listObjEmCena[i].position.z= dados.solid[i].z;
			scene.add(listObjEmCena[i]);
			//groupBlocos.add(listObjEmCena[i]);
		}
		for (let i = 0; i < dados.link.length ; i++ ) {
			geometry2[i] = new THREE.BoxGeometry(dados.link[i].width,dados.link[i].height,dados.link[i].depth); //(largura,altura,profundidade) Parede esquerda
			listlinksEmCena[i] = new THREE.Mesh( geometry2[i], materialCristal[1] );
			listlinksEmCena[i].position.x= dados.link[i].x;
			listlinksEmCena[i].position.y= dados.link[i].y;
			listlinksEmCena[i].position.z= dados.link[i].z;
			scene.add(listlinksEmCena[i]);
			//groupBlocos.add(listlinksEmCena[i]);
		}
		//scene.add(groupBlocos);
	}
}


function initRender(){
	renderer = new THREE.WebGLRenderer({antialias : true}); //renderer = new THREE.WebGLRenderer();
	renderer.setSize(largura/2,altura/2);
	//renderer.shadowMapEnabled = true;
	renderer.shadowMap.enabled = true //sombra
	renderer.shadowMap.type = THREE.PCFSoftShadowMap; //Sombra
}


function criarUmCristal(TempIndex, tempGeometry, tempMaterial){
	objCristal[TempIndex] = new THREE.Mesh(tempGeometry, materialCristal[tempMaterial]); // cristais
	objCristal[TempIndex].rotation.y = 1.5708; //1.5708radianos==90graus
	objCristal[TempIndex].position.y = -200;
	objCristal[TempIndex].scale.x = 20;
	objCristal[TempIndex].scale.y = 20;
	objCristal[TempIndex].scale.z = 20;
	scene.add(objCristal[TempIndex]);
}


function initGLTFCristais(){
	let urlObj3DglbRobo = "/static/cristalbot/3d/cristais.glb";
	let loaderObj3DRobo = new THREE.GLTFLoader();
	let num = 0;
    loaderObj3DRobo.load( urlObj3DglbRobo, function ( gltf ) {
		criarUmCristal(num, gltf.scene.children[0].geometry, 4); //y=-91(plator1)
		num++
		criarUmCristal(num, gltf.scene.children[1].geometry, 2);
		num++
		criarUmCristal(num, gltf.scene.children[2].geometry, 3);
		num++
		criarUmCristal(num, gltf.scene.children[3].geometry, 0);
		num++
		criarUmCristal(num, gltf.scene.children[4].geometry, 1);
		num++
		cargaCompleta();
	})
}


function crirUmaBateria(tempIndex, x, y, z){
	baterias.estoque[tempIndex] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[tempIndex].position.set( x, y, z);
	baterias.estoque[tempIndex].rotation.y = -1;
}

//function initBaterias(tempGeometry){
function initBaterias(){
	
	// Baterias do gerador e da garra
	baterias.garra[0] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	scene.add(baterias.garra[0]);
	baterias.garra[1] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	scene.add(baterias.garra[1]);
	baterias.garra[2] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	scene.add(baterias.garra[2]);
	//baterias.garra[3] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	//scene.add(baterias.garra[3]);
	//baterias.garra[4] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	//scene.add(baterias.garra[4]);

	// Baterias do estoque
	baterias.estoque[0] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[1] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[2] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[3] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[4] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[5] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[6] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[7] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[8] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[9] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[10] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[11] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[12] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[13] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)
	baterias.estoque[14] = new THREE.Mesh(baterias.gltf, materialRobo); // Tambor (bateria)

	crirUmaBateria(0, -23, 1, 6 );
	crirUmaBateria(1, -23, 1, 3 );
	crirUmaBateria(2, -23, 1, 0 );
	crirUmaBateria(3, -23, 1, -3 );
	crirUmaBateria(4, -23, 1, -6 );

	crirUmaBateria(5, -23, 4.5, 6 );
	crirUmaBateria(6, -23, 4.5, 3 );
	crirUmaBateria(7, -23, 4.5, 0 );
	crirUmaBateria(8, -23, 4.5, -3 );
	crirUmaBateria(9, -23, 4.5, -6 );

	crirUmaBateria(10, -20, 1, 6 );
	crirUmaBateria(11, -20, 1, 3 );
	crirUmaBateria(12, -20, 1, 0 );
	crirUmaBateria(13, -20, 1, -3 );
	crirUmaBateria(14, -20, 1, -6 );

	moverBaterias(1);
}

var objMina = [];

function moveMinasPlator(){
	console.log("moveMinasPlator() - platorAtual="+platorAtual)
	for (let i = 0; i < dados.mina[platorAtual].length ; i++ ) {
		objCristal[i].position.x = dados.mina[platorAtual][i].x;
		objCristal[i].position.y = dados.mina[platorAtual][i].y-15;
		objCristal[i].position.z = dados.mina[platorAtual][i].z;
		objMina[i].minafechada.position.x=dados.mina[platorAtual][i].x;
		objMina[i].minafechada.position.y=dados.mina[platorAtual][i].y;
		objMina[i].minafechada.position.z=dados.mina[platorAtual][i].z;
		objMina[i].minaaberta.position.x =dados.mina[platorAtual][i].x; 
		objMina[i].minaaberta.position.y =dados.mina[platorAtual][i].y; 
		objMina[i].minaaberta.position.z =dados.mina[platorAtual][i].z; 
	}
}
	

//function criarUmaMina(TempIndex, tempMinaFechada, TempMinaAberta, TempPlator){
function criarUmaMina(TempIndex, tempMinaFechada, TempMinaAberta, TempPlator){
	let objMinaFechada = new THREE.Mesh(tempMinaFechada, materialLua); // cristais
	let objMinaAberta = new THREE.Mesh(TempMinaAberta, materialLua); // cristais
	objMina[TempIndex] = {minafechada:objMinaFechada, minaaberta:objMinaAberta}
	objMina[TempIndex].minafechada.rotation.y = 3.1416; //1.5708radianos==90graus;
	//objMina[TempIndex].minafechada.position.x = dados.mina[1][TempIndex].x; //tempx; //dados.link[i].x;
	objMina[TempIndex].minafechada.position.y = -200; //dados.mina[1][TempIndex].y; //tempY+50; //dados.link[i].y;
	//objMina[TempIndex].minafechada.position.z = dados.mina[1][TempIndex].z; //tempZ; //dados.link[i].z;
	objMina[TempIndex].minafechada.scale.x = 20;
	objMina[TempIndex].minafechada.scale.y = 20;
	objMina[TempIndex].minafechada.scale.z = 20;
	scene.add(objMina[TempIndex].minafechada);
	objMina[TempIndex].minaaberta.rotation.y = 3.1416; //1.5708radianos==90graus;
	//objMina[TempIndex].minaaberta.position.x = dados.mina[1][TempIndex].x; //tempx; //dados.link[i].x;
	objMina[TempIndex].minaaberta.position.y = -200; //dados.mina[1][TempIndex].y; //tempY; //dados.link[i].y;
	//objMina[TempIndex].minaaberta.position.z = dados.mina[1][TempIndex].z; //tempZ; //dados.link[i].z;
	objMina[TempIndex].minaaberta.scale.x = 20;
	objMina[TempIndex].minaaberta.scale.y = 20;
	objMina[TempIndex].minaaberta.scale.z = 20;
	scene.add(objMina[TempIndex].minaaberta);
}

var groupFuradeira


function initGLTFAcessorios(){
	let urlObj3DglbRobo = "/static/cristalbot/3d/cristalbot_acessorios.glb";
	let loaderObj3DRobo = new THREE.GLTFLoader();
	groupFuradeira = new THREE.Group();
	
    loaderObj3DRobo.load( urlObj3DglbRobo, function ( gltf ) {
		//Baterias====================================================================
		//initBaterias(gltf.scene.children[0].geometry); //tambor
		baterias = {gltf:gltf.scene.children[0].geometry, garra:[], estoque:[]};
		initBaterias();

		//Furadeira====================================================================
		let furadeiraBroca = new THREE.Mesh(gltf.scene.children[1].geometry, materialRobo); //Broca furadeira
		groupFuradeira.add(furadeiraBroca);
		let furadeiraMotor = new THREE.Mesh(gltf.scene.children[2].geometry, materialRobo); //Corpo furadeira
		groupFuradeira.add(furadeiraMotor);
		//groupFuradeira.scale.x = 10;
		//groupFuradeira.scale.y = 10;
		//groupFuradeira.scale.z = 10;
		//scene.add(groupFuradeira);

		//Minas=de=cristais==============================================================
		criarUmaMina(0, gltf.scene.children[4].geometry, gltf.scene.children[3].geometry, 1); // minaFechada // MinaAberta
		criarUmaMina(1, gltf.scene.children[4].geometry, gltf.scene.children[3].geometry, 1) // minaFechada // MinaAberta
		criarUmaMina(2, gltf.scene.children[4].geometry, gltf.scene.children[3].geometry, 1) // minaFechada // MinaAberta
		criarUmaMina(3, gltf.scene.children[4].geometry, gltf.scene.children[3].geometry, 1) // minaFechada // MinaAberta
		criarUmaMina(4, gltf.scene.children[4].geometry, gltf.scene.children[3].geometry, 1) // minaFechada // MinaAberta
		cargaCompleta();
	})
}



function initCeu(){
	fundCeu = new THREE.Sprite( materialCeu[0] ); 	// Ceu de marte - Sprit
	fundCeu.scale.set(8000, 1680, 1); //5000x1050 = 4000x840 = 2000x420 (1000x210)
	fundCeu.position.x = 0;
	fundCeu.position.y = 100;//750;
	fundCeu.position.z = -1000;//-2200;
	scene.add(fundCeu);
}


function trocaPlaneta(novoPlaneta){
	if(novoPlaneta!==PlanetaAtual){
		fechaJanela("idWinMenu");
		//fechaJanela("idWinPlanetas")
		//"Lua", "Marte", "Mercurio", "Plutao", "Venus"
		if(PlanetaAtual=="Lua"){
			
			scene.remove(TerrenoLua);
			scene.remove(luz.Lua[0]); //Adicionar luz ambiente da lua a cena.
			scene.remove(luz.Lua[1]); //Adicionar luz ambiente da lua a cena.
			if(debugging){
				scene.remove(luz.Lua[2]); //Adicionar Helper da luz direcional
			}
		}else if(PlanetaAtual=="Marte"){
			
			scene.remove(TerrenoMarte);
			scene.remove(luz.Marte[0]); //Adicionar luz ambiente da Marte a cena.
			scene.remove(luz.Marte[1]); //Adicionar luz ambiente da Marte a cena.
			if(debugging){
				scene.remove(luz.Marte[2]); //Adicionar Helper da luz direcional
			}
		}else if(PlanetaAtual=="Mercurio"){
			
			scene.remove(TerrenoMercurio);
			scene.remove(luz.Mercurio[0]); //Adicionar luz ambiente da Mercurio a cena.
			scene.remove(luz.Mercurio[1]); //Adicionar luz ambiente da Mercurio a cena.
			if(debugging){
				scene.remove(luz.Mercurio[2]); //Adicionar Helper da luz direcional
			}
		}else if(PlanetaAtual=="Plutao"){
			
			scene.remove(TerrenoPlutao);
			scene.remove(luz.Plutao[0]); //Adicionar luz ambiente da Plutao a cena.
			scene.remove(luz.Plutao[1]); //Adicionar luz ambiente da Plutao a cena.
			if(debugging){
				scene.remove(luz.Plutao[2]); //Adicionar Helper da luz direcional
			}
		}else if(PlanetaAtual=="Venus"){
			
			scene.remove(TerrenoVenus);
			scene.remove(luz.Venus[0]); //Adicionar luz ambiente da Venus a cena.
			scene.remove(luz.Venus[1]); //Adicionar luz ambiente da Venus a cena.
			if(debugging){
				scene.remove(luz.Venus[2]); //Adicionar Helper da luz direcional
			}
		}

		//"Lua", "Marte", "Mercurio", "Plutao", "Venus"
		if(novoPlaneta=="Lua"){
			funSound(1,"vento.mp3");
			scene.add(TerrenoLua);
			fundCeu.material = materialCeu[0] // Sprite do ceu
			//Iluminacao da Lua (luz)
			scene.add(luz.Lua[0]); //Adicionar luz ambiente da lua a cena.
			scene.add(luz.Lua[1]); //Adicionar luz ambiente da lua a cena.

			trocaTexturaMina(materialLua);
			if(debugging){
				scene.add(luz.Lua[2]); //Adicionar Helper da luz direcional
			}
		}else if(novoPlaneta=="Marte"){
			funSound(1,"vento.mp3");
			scene.add(TerrenoMarte);
			fundCeu.material = materialCeu[1] // Sprite do ceu
			//Iluminacao da Marte (luz)
			scene.add(luz.Marte[0]); //Adicionar luz ambiente da Marte a cena.
			scene.add(luz.Marte[1]); //Adicionar luz ambiente da Marte a cena.
			trocaTexturaMina(materialMarte);
			if(debugging){
				scene.add(luz.Marte[2]); //Adicionar Helper da Marte direcional
			}
		}else if(novoPlaneta=="Mercurio"){
			funSound(1,"vento.mp3");
			scene.add(TerrenoMercurio);
			fundCeu.material = materialCeu[2] // Sprite do ceu
			//Iluminacao da Mercurio (luz)
			scene.add(luz.Mercurio[0]); //Adicionar luz ambiente da Mercurio a cena.
			scene.add(luz.Mercurio[1]); //Adicionar luz ambiente da Mercurio a cena.
			trocaTexturaMina(materialMercurio);
			if(debugging){
				scene.add(luz.Mercurio[2]); //Adicionar Helper da Mercurio direcional
			}
		}else if(novoPlaneta=="Plutao"){
			funSound(1,"vento.mp3");
			scene.add(TerrenoPlutao);
			fundCeu.material = materialCeu[3] // Sprite do ceu
			//Iluminacao da Plutao (luz)
			scene.add(luz.Plutao[0]); //Adicionar luz ambiente da Plutao a cena.
			scene.add(luz.Plutao[1]); //Adicionar luz ambiente da Plutao a cena.
			trocaTexturaMina(materialPlutao);
			if(debugging){
				scene.add(luz.Plutao[2]); //Adicionar Helper da Plutao direcional
			}
		}else if(novoPlaneta=="Venus"){
			funSound(1,"TerrenoVenusCorte.m4a");
			scene.add(TerrenoVenus);
			fundCeu.material = materialCeu[4] // Sprite do ceu
			//Iluminacao da Venus (luz)
			scene.add(luz.Venus[0]); //Adicionar luz ambiente da Venus a cena.
			scene.add(luz.Venus[1]); //Adicionar luz ambiente da Venus a cena.
			trocaTexturaMina(materialVenus);
			if(debugging){
				scene.add(luz.Venus[2]); //Adicionar Helper da Venus direcional
			}
		}

	}
	
	PlanetaAtual=novoPlaneta; // Atualisa variavel global PlanetaAtual.
	idSpanPlaneta.textContent = PlanetaAtual;
	//zerar estoque
	//Zerar conversores(geradores)
	//zerar bateria
	// Zerar posição da nave
	stareNave=1; //stareNave = 1 = subindo
	platorAtual=0;
	funSound(2, "VooDaNaveWav.m4a"); // Tocar uma musiquinha no inicio.
 	moverNave();
	
}


function trocaTexturaMina(tempMaterial){
	objMina[0].minaaberta.material = tempMaterial;
	objMina[1].minaaberta.material = tempMaterial;
	objMina[2].minaaberta.material = tempMaterial;
	objMina[3].minaaberta.material = tempMaterial;
	objMina[4].minaaberta.material = tempMaterial;

	objMina[0].minafechada.material = tempMaterial;
	objMina[1].minafechada.material = tempMaterial;
	objMina[2].minafechada.material = tempMaterial;
	objMina[3].minafechada.material = tempMaterial;
	objMina[4].minafechada.material = tempMaterial;
}


function initGLTFTerreno(){
	let urlObj3DglbTerreno = "/static/cristalbot/3d/cristalbot_terrenos.glb";
	//let urlObj3DglbTerreno = "/static/cristalbot/3d/game_robo_04.glb";
	let loaderObj3DTerreno = new THREE.GLTFLoader();
    loaderObj3DTerreno.load( urlObj3DglbTerreno, function ( gltf ) {

		TerrenoLua  = new THREE.Mesh(gltf.scene.children[0].geometry, materialLua); // Terreno Lua
		TerrenoLua.scale.x = 80;
		TerrenoLua.scale.y = 40;
		TerrenoLua.scale.z = 80;
		TerrenoLua.position.y=-110;
		TerrenoLua.rotation.y=1.5708; //1.5708radianos==90graus
		scene.add(TerrenoLua);

		TerrenoMarte  = new THREE.Mesh(gltf.scene.children[1].geometry, materialMarte); // Terreno marte
		TerrenoMarte.scale.x = 80;
		TerrenoMarte.scale.y = 80;
		TerrenoMarte.scale.z = 80;
		TerrenoMarte.position.y=-110;
		TerrenoMarte.rotation.y=-1.5708; //1.5708radianos==90graus

		TerrenoMercurio  = new THREE.Mesh(gltf.scene.children[0].geometry, materialMercurio); // "3" Terreno Mercurio
		TerrenoMercurio.scale.x = 80;
		TerrenoMercurio.scale.y = 80;
		TerrenoMercurio.scale.z = 80;
		TerrenoMercurio.position.z=120;
		TerrenoMercurio.position.y=-110;
		TerrenoMercurio.rotation.y=1.5708; //1.5708radianos==90graus
		
		TerrenoPlutao  = new THREE.Mesh(gltf.scene.children[1].geometry, materialPlutao); // "4" Terreno Plutao
		TerrenoPlutao.scale.x = 80;
		TerrenoPlutao.scale.y = 80;
		TerrenoPlutao.scale.z = 80;
		TerrenoPlutao.position.z=180;
		TerrenoPlutao.position.y=-110;
		TerrenoPlutao.rotation.y=1.5708; //1.5708radianos==90graus
		
		TerrenoVenus  = new THREE.Mesh(gltf.scene.children[1].geometry, materialVenus); // "5" Terreno Venus
		TerrenoVenus.scale.x = 80;
		TerrenoVenus.scale.y = 80;
		TerrenoVenus.scale.z = 80;
		TerrenoVenus.position.z=180;
		TerrenoVenus.position.y=-110;
		TerrenoVenus.rotation.y=1.5708; //1.5708radianos==90graus

		cargaCompleta();
	})
	
}




function moverBraco(){
	if(stateArm>0){
		if(bracoRobo.rotation.x>-2){
			bracoRobo.rotation.x = bracoRobo.rotation.x-0.1;
			garraRobo.rotation.x = garraRobo.rotation.x+0.04;
		}else{
			stateArm=-1;
		}
	}else if (stateArm<0){
		if(bracoRobo.rotation.x<0){
			bracoRobo.rotation.x = bracoRobo.rotation.x+0.1;
			garraRobo.rotation.x = garraRobo.rotation.x-0.04;
		}else{
			stateArm=0;
		}
	}else{
		bracoRobo.rotation.x=0;
		garraRobo.rotation.x=0;
	}
}



function initGLTFRobo(){
	let urlObj3DglbRobo = "/static/cristalbot/3d/game_robo_04.glb";
	let loaderObj3DRobo = new THREE.GLTFLoader();
    loaderObj3DRobo.load( urlObj3DglbRobo, function ( gltf ) {

		groupRobo = new THREE.Group();
		groupBracoRobo = new THREE.Group();

		let obj = [];
		let i = 0;

		obj[0] = new THREE.Mesh(gltf.scene.children[i++].geometry, materialRobo); // corpo
		groupRobo.add(obj[0]);

		rodasRobo[0] = new THREE.Mesh(gltf.scene.children[i++].geometry, materialRobo); // Roda 1
		rodasRobo[0].position.z = -1;
		//obj[i].position.x = -0.4;
		//obj[i].position.y = 0.5;
		groupRobo.add(rodasRobo[0]);

		//-----------------------------------------
		garraRobo = new THREE.Mesh(gltf.scene.children[i++].geometry, materialRobo); // Garra camera
		groupBracoRobo.add(garraRobo);

		bracoRobo = new THREE.Mesh(gltf.scene.children[i++].geometry, materialRobo); // braço
		
		bracoRobo.add(garraRobo);
		groupRobo.add(bracoRobo);

		bracoRobo.position.y = 1.5708; //1.5708radianos==90graus
		bracoRobo.position.z = -0.5;
		garraRobo.position.y = 1.5708; //1.5708radianos==90graus
		garraRobo.position.z = 2.5;
		//-----------------------------------------

		rodasRobo[1] = new THREE.Mesh(gltf.scene.children[i++].geometry, materialRobo); // Roda 2
		rodasRobo[1].position.z = 1;
		groupRobo.add(rodasRobo[1]);

		rodasRobo[2] = new THREE.Mesh(gltf.scene.children[i++].geometry, materialRobo); // Roda 3
		rodasRobo[2].position.z = -1;
		groupRobo.add(rodasRobo[2]);

		rodasRobo[3] = new THREE.Mesh(gltf.scene.children[i++].geometry, materialRobo); // Roda 4
		rodasRobo[3].position.z = 1;
		groupRobo.add(rodasRobo[3]);

		groupRobo.scale.x = 10;
		groupRobo.scale.y = 10;
		groupRobo.scale.z = 10;
		scene.add(groupRobo);


		energiaRobo = new THREE.Sprite( materialBarrinhaA );
		energiaRobo.scale.set(50, 5, 1);
		energiaRobo.position.x = groupRobo.position.x;
		energiaRobo.position.y = groupRobo.position.y;
		energiaRobo.position.z = groupRobo.position.z;

		
		//fundCeu.rotation.x = 0.15;
		scene.add(energiaRobo);
		energiaRobo2 = new THREE.Sprite( materialBarrinhaB );
		energiaRobo2.scale.set(50, 5, 1);
		energiaRobo2.position.x = groupRobo.position.x;
		energiaRobo2.position.y = groupRobo.position.y;
		energiaRobo2.position.z = groupRobo.position.z;
		//fundCeu.rotation.x = 0.15;
		scene.add(energiaRobo2);	
		cargaCompleta()
	})
}



function GirarRodas(){
	if(anguloRoda<-3){
		anguloRoda=3;
	}else{
		anguloRoda=anguloRoda-0.2;
	}
	rodasRobo[0].rotation.x = anguloRoda;
	rodasRobo[1].rotation.x = anguloRoda;
	rodasRobo[2].rotation.x = anguloRoda;
	rodasRobo[3].rotation.x = anguloRoda;
}

var objVidroNave


function vidroVisivel(TempViro){
	if(TempViro){
		objVidroNave.position.y = 0; // escondendo o vidro.
	}else{
		objVidroNave.position.y = -500; // escondendo o vidro.
	}	
}


function initGLTFNaveMae(){
	// Carregar nova nave
	let urlObj3DglbNave = "/static/cristalbot/3d/cristal_bot_novo_js.glb";
	let loaderObj3DNave = new THREE.GLTFLoader();
	
    loaderObj3DNave.load( urlObj3DglbNave, function ( gltf ) {

		groupNaveMae = new THREE.Group();

		let obj = [];
		let i = 0;

		obj[i] = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // Parede1 nave
		groupNaveMae.add(obj[i]);
		i++

		obj[i] = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // Chao nave
		groupNaveMae.add(obj[i]);
		i++

		obj[i] = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // Parede2 nave
		groupNaveMae.add(obj[i]);
		i++

		obj[i] = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // teto nave
		groupNaveMae.add(obj[i]);
		i++

		obj[i] = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // cabine
		groupNaveMae.add(obj[i]);
		i++

		objVidroNave = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // Vidro Nave
		vidroVisivel(false);
		groupNaveMae.add(objVidroNave);
		i++

		objPortaNave = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // porta Nave
		objPortaNave.position.z = -8.5//-8;
		objPortaNave.position.x = -0.4;
		objPortaNave.position.y = 0.5;
		groupNaveMae.add(objPortaNave);
		i++

		// Iniciar conversores na nave.
		let contConveres = 0;

		Converes[0] = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // Conversor 1
		//Converes[0].position.y = -2;//1;
		//Converes[0].position.x = 24;
		//Converes[0].position.z = 5;
		//Converes[0].scale.y = 0.5;
		//Converes[0].state=0;
		Converes[0].position.y = -2;//1;
		Converes[0].position.x = 24;
		Converes[0].position.z = 0;
		Converes[0].scale.y = 0.5;
		Converes[0].state=0;
		groupNaveMae.add(Converes[0]);

		Converes[1] = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // Conversor 2
		//Converes[1].position.y = -2;//1;
		//Converes[1].position.x = 24;
		//Converes[1].position.z = 2.5;
		//Converes[1].scale.y = 0.5;
		//Converes[1].state=0;
		Converes[1].position.y = -2;//1;
		Converes[1].position.x = 24;
		Converes[1].position.z = -2.5;
		Converes[1].scale.y = 0.5;
		Converes[1].state=0;
		groupNaveMae.add(Converes[1]);

		Converes[2] = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // Conversor 3
		//Converes[2].position.y = -2;//1;
		//Converes[2].position.x = 24;
		//Converes[2].position.z = 0;
		//Converes[2].scale.y = 0.5;
		//Converes[2].state=0;
		Converes[2].position.y = -2;//1;
		Converes[2].position.x = 24;
		Converes[2].position.z = -5;
		Converes[2].scale.y = 0.5;
		Converes[2].state=0;
		groupNaveMae.add(Converes[2]);
		
		/*
		Converes[contConveres] = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // Conversor 2
		Converes[contConveres].position.y = -2;//1;
		Converes[contConveres].position.x = 24;
		Converes[contConveres].position.z = -2.5;
		Converes[contConveres].scale.y = 0.5;
		Converes[contConveres].state=0;
		groupNaveMae.add(Converes[contConveres++]);

		Converes[contConveres] = new THREE.Mesh(gltf.scene.children[i].geometry, materialRobo); // Conversor 1
		Converes[contConveres].position.y = -2;//1;
		Converes[contConveres].position.x = 24;
		Converes[contConveres].position.z = -5;
		Converes[contConveres].scale.y = 0.5;
		Converes[contConveres].state=0;
		groupNaveMae.add(Converes[contConveres++]);
		*/

		i++


		groupNaveMae.scale.x = 10;
		groupNaveMae.scale.y = 10;
		groupNaveMae.scale.z = 10;
		groupNaveMae.rotation.y = 3.1416; //3.1416radiano==180graus

		
		scene.add(groupNaveMae);

		//groupNaveMae.position.y=400;
		//groupNaveMae.position.z=2000;
		stareNave=-1; // Estado da Nave 0 (parado)
		platorAtual=0;
		statePorta=1 // abrePorta();

		cargaCompleta();
	})
}


function moverBaterias(TempPlatform){
	//move as baterias dos conversores.
	if(TempPlatform==1){
		for(let i=0; i<3; i++){
			baterias.garra[i].position.y = -180;//-1//2;
			baterias.garra[i].position.x = -216;//22;
			baterias.garra[i].scale.x = 10;//0.5;
			baterias.garra[i].scale.y = 5;//0.5;
			baterias.garra[i].scale.z = 10;//0.5;
		}
		baterias.garra[0].position.z = 1194; //1142;
		baterias.garra[1].position.z = 1222; //1166;
		baterias.garra[2].position.z = 1246; //1194;
		//baterias.garra[3].position.z = 1222;
		//baterias.garra[4].position.z = 1246;
	}else if(TempPlatform==2){
		for(let i=0; i<3; i++){
			baterias.garra[i].position.y = -80;//-1//2;
			baterias.garra[i].position.x = -216;//22;
			baterias.garra[i].scale.x = 10;//0.5;
			baterias.garra[i].scale.y = 10;//0.5;
			baterias.garra[i].scale.z = 10;//0.5;
		}
		baterias.garra[0].position.z = 1194; //1142;
		baterias.garra[1].position.z = 1222; //1166;
		baterias.garra[2].position.z = 1246; //1194;
		//baterias.garra[3].position.z = 1222;
		//baterias.garra[4].position.z = 1246;
	}else if(TempPlatform==3){
		for(let i=0; i<3; i++){
			baterias.garra[i].position.y = -80;//-1//2;
			baterias.garra[i].position.x = -216;//22;
			baterias.garra[i].scale.x = 10;//0.5;
			baterias.garra[i].scale.y = 10;//0.5;
			baterias.garra[i].scale.z = 10;//0.5;
		}
		baterias.garra[0].position.z = 1194; //1142;
		baterias.garra[1].position.z = 1222; //1166;
		baterias.garra[2].position.z = 1246; //1194;
		//baterias.garra[3].position.z = 1222;
		//baterias.garra[4].position.z = 1246;
	}
}




function cargaCompleta() {
	totalCarga++;
	if(totalCarga>=5){
		fechaJanela("idWinIntro2");
		//idWinMenu.style.display = "block"; // Mostrar menuprincipal.
		//idWinLoad.style.display = "none"; // esconder Janela Carregando.
		addFuradeiraMae()
		
	}
}

function initAnimate(){

	idButInit.style.display = "none"; // Mostrar butao iniciar jogo
	idButVoltar.style.display = "block"; // esconder butao voltar ao jogo

	fechaJanela("idWinMenu"); //idWinMenu.style.display = "none"; // esconder menu principal.
	trocaPlaneta("Lua"); // PlanetaAtual "Lua" //"Lua", "Marte", "Mercurio", "Plutao", "Venus"
	funSound(2, "VooDaNaveWav.m4a"); // Tocar uma musiquinha no inicio.
	//groupNaveMae.position.z=1200 
	//groupNaveMae.position.y=-97
	animate();
}


function animate() {
	//if(rumGame){
		if(contFuradeira>0){
			contFuradeira--;
		}
		moverBraco();
		moverPorta();
		moverNave();
		moverPersonagem();
		funAction();
		animaGerador();
		//animaPersonagem();
		//animaInimigos();
		//animaChao();
		//colidNaves();
		//animaLazer();
		//animaExplosao();
		renderer.render(scene, camera);
		requestAnimationFrame( animate ); //Chamar esta funcao novamente quando terminar.
	//}
}



function moverNave(){
	if(stareNave == 1){
		moverBaterias(0);
		//stareNave = 1 = subindo
		if(platorAtual==0){
			groupNaveMae.position.y=400;
			groupNaveMae.position.z=2000;
		}
		if(groupNaveMae.position.y<400){
			groupNaveMae.position.y = groupNaveMae.position.y+5;
			groupNaveMae.position.z = groupNaveMae.position.z+1;
			moveRoboNave(groupNaveMae.position.x, groupNaveMae.position.y, groupNaveMae.position.z);
		}else{
			stareNave = -1
			funSound(2, "VooDaNaveWav.m4a"); // Tocar uma musiquinha no inicio.
		}
		moveCeu(groupNaveMae.position.x, groupNaveMae.position.y, groupNaveMae.position.z);

	}else if(stareNave == -1){
		//stareNave = -1 = descendo

		if(platorAtual==0){
			// Indo para plator 1
			if(groupNaveMae.position.z<1200){
				groupNaveMae.position.z = groupNaveMae.position.z+5;
			}else{
				groupNaveMae.position.z=1200 
			}
			if(groupNaveMae.position.y>-97){
				groupNaveMae.position.y = groupNaveMae.position.y-10; //-97				
				moveRoboNave(groupNaveMae.position.x, groupNaveMae.position.y, groupNaveMae.position.z);
				groupNaveMae.position.x = 0; //-300;
			}else{
				navePousou(1);
			}

		} else if(platorAtual==1) {
			// Indo para plator 2

			if(groupNaveMae.position.z>-70){
				groupNaveMae.position.z = groupNaveMae.position.z-5;
			}else{
				groupNaveMae.position.z=-70 
			}

			if(PlanetaAtual=="Lua"){
				if(groupNaveMae.position.y>-35){
					// Posição 1 nave:
					groupNaveMae.position.y = groupNaveMae.position.y-1;				
					moveRoboNave(groupNaveMae.position.x, groupNaveMae.position.y, groupNaveMae.position.z);
				}else{
					navePousou(2);
				}
			}else{
				if(groupNaveMae.position.y>57){
					groupNaveMae.position.y = groupNaveMae.position.y-1;
					moveRoboNave(groupNaveMae.position.x, groupNaveMae.position.y, groupNaveMae.position.z);
				}else{
					navePousou(2);
				}
			}


		} else if(platorAtual==2) {
			// Indo para plator 3
			if(groupNaveMae.position.z>-1400){
				groupNaveMae.position.z = groupNaveMae.position.z-5;
			}else{
				groupNaveMae.position.z=-1400 
			}
			if(groupNaveMae.position.y>-97){
				groupNaveMae.position.y = groupNaveMae.position.y-1;	
				moveRoboNave(groupNaveMae.position.x, groupNaveMae.position.y, groupNaveMae.position.z);
			}else{
				navePousou(3);
			}
		}

		moveCeu(groupNaveMae.position.x, groupNaveMae.position.y, groupNaveMae.position.z);
		//moveRoboNave(groupNaveMae.position.x, groupNaveMae.position.y, groupNaveMae.position.z);
	}
}

function navePousou(TempPlator){
	
	platorAtual=TempPlator;
	stareNave=0; // Estado da Nave 0 (parado)
	statePorta=1 // abrePorta();
	dados.solid = funDadosSolid(TempPlator);
	dados.link = funDadosLinks(TempPlator);
	gerandoBlocos();
	moveMinasPlator();
	moverBaterias(TempPlator);
}

function moveCeu(varx,vary,varz){
	fundCeu.position.x = varx;
	fundCeu.position.y = vary+20  //100;//750;
	fundCeu.position.z = varz-2000 //-1000;//-2200;
}

function moveRoboNave(varx,vary,varz){

	luz.nave[0].position.x = varx-200;
	luz.nave[0].position.y = vary+50;
	luz.nave[0].position.z = varz;
	luz.nave[1].position.x = varx+200;
	luz.nave[1].position.y = vary+50;
	luz.nave[1].position.z = varz;

	groupRobo.position.x = varx
	groupRobo.position.y = vary+12;
	groupRobo.position.z = varz;
	
	moverCamera(groupRobo.position.x, groupRobo.position.y, groupRobo.position.z, 400);
}

var statePorta=0;

function abrePorta(){
	if(statePortaAberta){
		statePorta=-1; //Fechar porta
		statePortaAberta=false
	}else{
		statePorta=1; // Abrir Porta
		statePortaAberta=true
	}
}

function moverPorta(){
	if(statePorta==1||statePorta==-1){
		funSound(2,"porta_nave.wav"); // Tocar uma musiquinha no inicio.
	}
	if(statePorta>0){
		vidroVisivel(false);
		if(objPortaNave.rotation.x>-1.8){
			objPortaNave.rotation.x = objPortaNave.rotation.x-0.1;//Abrimndo
		}else{
			statePorta=0;
		}
	}else if (statePorta<0){
		if(objPortaNave.rotation.x<0){
			objPortaNave.rotation.x = objPortaNave.rotation.x+0.1; //Fechando
		}else{
			statePorta=0;
			vidroVisivel(true);
		}
	}
}



function keyPush(e) {
    //Ações do teclado.
    var varKey = e.key;
    var varkeyCode = e.keyCode
    if (varkeyCode === 37 || varkeyCode === 65 || varKey == "ArrowLeft") {
		stateDirecao="<-";//console.log("37=(<)esquerda / 65=a"); //moverPersonagem("<-");
    } else if (varkeyCode === 39 || varkeyCode === 68 || varKey == "ArrowRight") {
		stateDirecao="->"; //console.log("39=(>)Direita / 68=d"); //moverPersonagem("->");
    } else if (varkeyCode === 40 || varkeyCode === 83 || varKey == "ArrowDown") {
		stateDirecao="re"; //console.log("40=seta pra baixo / 83=s"); //moverPersonagem("re"); //"descer"
    } else if (varkeyCode === 87 || varkeyCode === 38 || varKey == "ArrowUp") {
		stateDirecao="frente"; //console.log("30=seta pra cima / 87=w"); //moverPersonagem("frente"); //"subir"
    } else if (varkeyCode === 82 || varKey == "r") {
		if(debugging){stateDirecao="subir"}; //moverPersonagem("subir");	//voar/subir/pular  
    } else if (varkeyCode === 70 || varKey == "f") {
		if(debugging){stateDirecao="descer"}; //moverPersonagem("descer"); //descer/abaixar
	} else if (varkeyCode === 32 || varKey == " ") {
		if(debugging){stateDirecao="pula"}; //moverPersonagem("pula"); //descer/abaixar 
	} else if (varKey == "p") {
	  abrePorta();
	} else if (varKey == "b") {
	  // Ir para 1o plator
	  stareNave=1; // Subir nave 
	  platorAtual=0; // Definir que esta no platpr 0, vai pra o plator 1.
	  statePorta=-1	  //fechar Porta;
	} else if (varKey == "n") {
	  // Ir para 2o plator
	  stareNave=1; // Subir nave 
	  platorAtual=1; // Definir que esta no platpr 1, vai pra o plator 2.
	  statePorta=-1 //fechar Porta;
	} else if (varKey == "m") {
	  // Ir para 3o plator
	  stareNave=1; // Subir nave 
	  platorAtual=2; // Definir que esta no platpr 2, vai pra o plator 3.
	  statePorta=-1 //fechar Porta;
	}else if (varKey == "g") {
	  stateArm=1; // MOve garra e braco.
	} else if (varKey == "1") {
	  trocaPlaneta("Lua"); //"Lua", "Marte", "Mercurio", "Plutao", "Venus"
	} else if (varKey == "2") {
	  trocaPlaneta("Marte"); //"Lua", "Marte", "Mercurio", "Plutao", "Venus"
	} else if (varKey == "3") {
	  trocaPlaneta("Mercurio"); //"Lua", "Marte", "Mercurio", "Plutao", "Venus"
	} else if (varKey == "4") {
	  trocaPlaneta("Plutao"); //"Lua", "Marte", "Mercurio", "Plutao", "Venus"
	} else if (varKey == "5") {
	  trocaPlaneta("Venus"); //"Lua", "Marte", "Mercurio", "Plutao", "Venus"
    } else{
	  console.log("varkeyCode:"+varkeyCode+" | varKey:"+varKey);
	}
  }
 
function colidBox2d(rect1, rect2){
  if(rect1.x+rect1.width/2 > rect2.x-rect2.width/2 &&
	rect1.x-rect1.width/2 < rect2.x+rect2.width/2 &&
	rect1.z+rect1.width/2 > rect2.y-rect2.width/2 &&
	rect1.y-rect1.width/2 < rect2.y+rect2.width/2){
	//tocou
	//console.log("tocou");
	return true;
  } 
  //não tocou
  return false;
}

function colidBox3d(rect1, rect2){
  if(rect1.x+rect1.width/2 > rect2.x-rect2.width/2 &&
	rect1.x-rect1.width/2 < rect2.x+rect2.width/2 &&
	rect1.y+rect1.height/2 > rect2.y-rect2.height/2 &&
	rect1.y-rect1.height/2 < rect2.y+rect2.height/2 &&
	rect1.z+rect1.depth/2 > rect2.z-rect2.depth/2 &&
	rect1.z-rect1.depth/2 < rect2.z+rect2.depth/2
	){
	//tocou
	//console.log("tocou");
	return true;
  } 
  //não tocou
  return false;
}



function colideForObjetos(){
	let respTocou = false;
	let TocouSolido = false;
	let Tocoulink = false;
	let platorTemp = platorAtual-1;
	for (let i = 0; i < dados.solid.length ; i++ ) {
		//if(listObjEmCena[i].type=="Mesh"){		
			TocouSolido = colidBox3d(
				{
				"x":dados.solid[i].x,
				"y":dados.solid[i].y,
				"z":dados.solid[i].z, 
				"width":dados.solid[i].width, 
				"height":dados.solid[i].height,
				"depth":dados.solid[i].depth
				},
				{
				"x":groupRobo.position.x,
				"y":groupRobo.position.y,
				"z":groupRobo.position.z, 
				"width":28, 
				"height":28,
				"depth":28
				}
			);
		//}
		if(TocouSolido==true){
			respTocou = true;
			console.log("Tocou i="+i);
			i=dados.solid.length ;
		}
	}
	for (let i = 0; i < dados.link.length ; i++ ) {
		//if(listObjEmCena[i].type=="Mesh"){		
			Tocoulink = colidBox3d(
				{
				"x":dados.link[i].x,
				"y":dados.link[i].y,
				"z":dados.link[i].z, 
				"width":dados.link[i].width, 
				"height":dados.link[i].height,
				"depth":dados.link[i].depth
				},
				{
				"x":groupRobo.position.x,
				"y":groupRobo.position.y,
				"z":groupRobo.position.z, 
				"width":28, 
				"height":28,
				"depth":28
				}
			);
		//}

		if(Tocoulink==true){
			console.log("Link="+i);
			stateLink.action = dados.link[i].action;
			stateLink.state = dados.link[i].state;
			i=dados.link.length;
		}
	}
	console.log("bateu em um solido="+respTocou);
	return respTocou;
}

var stateLink = {action:"", state:""};
var stateEnergiaRobo= 50; //stateEnergiaRobo valor 50 até 0

function funAction(){
	if(stateLink.action!==""){
		console.log("action="+stateLink.action + ", state="+stateLink.state)
		if(stateLink.action=="cabine"){
			if(stateEnergiaRobo<50){
				stateEnergiaRobo=stateEnergiaRobo+0.1;
				energiaRobo2.scale.set(stateEnergiaRobo, 5, 1);
				let tempdesloca = 25 - (stateEnergiaRobo/2) //stateEnergiaRobo valor 50 até 0
				energiaRobo2.position.x = groupRobo.position.x-tempdesloca;
			}else{
				stateLink = {action:"", state:""};
			}
		}else if(stateLink.action=="gerador"){
			funTrataGerador();		
		}else if(stateLink.action=="estoque"){
			funTrataEstoque();
		}else if(stateLink.action=="furadeira"){
			funTratarFuradeira();			
		}else if(stateLink.action=="mina1"){
			funTratarMina(0);
		}else if(stateLink.action=="mina2"){
			funTratarMina(1);
		}else if(stateLink.action=="mina3"){
			funTratarMina(2);
		}else if(stateLink.action=="mina4"){
			funTratarMina(3);
		}else if(stateLink.action=="mina5"){
			funTratarMina(4);
		}else if(stateLink.action=="rampa1"){
			funTratarampa1();
		}else if(stateLink.action=="rampa3"){
			funTratarampa2();
		}
	}
}

function funTratarampa1(){
	if(platorAtual==2){
		groupRobo.position.y=groupNaveMae.position.y+20//-88 //-97
	}else{
		//platorAtual==1 e 3
		groupRobo.position.y=groupNaveMae.position.y+20//-88 //-97
	}
	stateLink = {action:"", state:""};
}

function funTratarampa2(){
	//,state:"on"}  //rampa descea
	if(platorAtual==2){
		groupRobo.position.y=groupNaveMae.position.y//-106 //-97
	}else{
		//platorAtual==1 e 3
		groupRobo.position.y=groupNaveMae.position.y//-106 //-97 
	}
	stateLink = {action:"", state:""};
}




function funTrataGerador(){
	let i = 0
	console.log("funTrataGerador(i="+i+")");
	//Converes.length
	for(let i=0; i<3; i++){
		if(Converes[i].state==0){
			funSound(2,"semBateria.wav");
			if(i==0){
				//Iniciar ativacao do conversor.
				Converes[i].state=100;//desligado disponivel.
				stateArm=1; // Move garra e braco.
			}else if(Converes[i-1].state==1){
				//Iniciar ativacao do conversor.
				Converes[i].state=100;//desligado disptonivel.
				stateArm=1; // Move garra e braco.
			}		
		}else if(Converes[i].state==1){
			//Ligado disponivel.
			if(NaGarra=="cristal"){
				//soltar cristal no gerador (NaGarraCristal)
				funSound(2,"cristal.m4a");
				console.log*("Soltar cristal("+NaGarraCristal+") no gerador "+i+".");
				stateArm=1; // Move garra e braco.
				Converes[i].cristal=NaGarraCristal;
				baterias.garra[i].position.y = -90
				objCristal[NaGarraCristal].position.y=groupNaveMae.position.y+20;
				objCristal[NaGarraCristal].position.x=baterias.garra[i].position.x; //(Converes[i].position.x*10);
				objCristal[NaGarraCristal].position.z=baterias.garra[i].position.z;
				NaGarra="";
				NaGarraCristal="";
				Converes[i].state=300;
			}
		}else if(Converes[i].state==2){
			// Bateria pronta
			if(NaGarra==""){
				stateArm=1; // Move garra e braco.
				NaGarra="bateria"; // colocar bateria na garra.
				NaGarraBateria = i; // Usando a bateria.
				Converes[i].state=1 // Liberar gerador para outro cristal.
			}

		}
	}
	stateLink = {action:"", state:""};
}

var totalBaterias = 0


//function funTrataEestoque(indexEstoque){
function funTrataEstoque(){
	console.log("funTrataEstoque() - Estoque de baterias. totalBaterias="+totalBaterias);
	if(NaGarra=="bateria"){
		stateArm=1; // Move garra e braco.
		//baterias[totalBaterias].position.y = -90; //-1,0,1,2; //Voltar bateria para posicaoinicial.
		baterias.garra[NaGarraBateria].position.y=-180;
		baterias.garra[NaGarraBateria].position.x=-216;
		//baterias.garra[NaGarraBateria].position.z=positgarra.z; 
		let TempBateria = totalBaterias
		if(platorAtual==2){
			TempBateria = 4+totalBaterias;
		}else if(platorAtual==3){
			TempBateria = 9+totalBaterias;
		}	
		groupNaveMae.add(baterias.estoque[TempBateria]);
		NaGarra = ""; //colocar bateria na garra.
		NaGarraBateria = ""; //indexGerador; // Usando a bateria 0
		totalBaterias++;

		if(totalBaterias>=3){
			totalBaterias-0;
			if(platorAtual==1){
				// Ir para 2o plator
				stareNave=1; // Subir nave 
				platorAtual=1; // Definir que esta no platpr 1, vai pra o plator 2.
				statePorta=-1 //fechar Porta;
			} else if (platorAtual==2) {
				// Ir para 3o plator
				stareNave=1; // Subir nave 
				platorAtual=2; // Definir que esta no platpr 2, vai pra o plator 3.
				statePorta=-1 //fechar Porta;
			} else if (platorAtual==3) {
				if(PlanetaAtual=="Lua"){
					trocaPlaneta("Marte");
				}else if(PlanetaAtual=="Marte"){
					trocaPlaneta("Mercurio");
				}else if(PlanetaAtual=="Mercurio"){
					trocaPlaneta("Plutao");
				}else if(PlanetaAtual=="Plutao"){
					trocaPlaneta("Venus");
				}else if(PlanetaAtual=="Venus"){
					trocaPlaneta("Lua");
				}
			}
		}
	}
	stateLink={action:"",state:""};
}

var contFuradeira=0;

function addFuradeiraMae(){
	groupNaveMae.add(groupFuradeira);
	groupFuradeira.position.x = 20 //-12;//90;
	groupFuradeira.position.y = 4;//45;
	groupFuradeira.position.z = 7;//-40;
	groupFuradeira.rotation.x = 0;
}


function funTratarFuradeira(){
	console.log("funTratarFuradeira()");
	//if(stateLink.state=="on"){
		if(NaGarra == ""){
			if(contFuradeira<1){
				// Pega Furadeira
				stateArm=1; // Move garra e braco.
				NaGarra = "furadeira"; //colocar furadeira na garra
				contFuradeira=50;

				groupNaveMae.remove(groupFuradeira);
				garraRobo.add(groupFuradeira);
				//groupFuradeira.scale.x = 1;
				//groupFuradeira.scale.y = 1;
				//groupFuradeira.scale.z = 1;
				groupFuradeira.position.x = 0;
				groupFuradeira.position.y = 0;
				groupFuradeira.position.z = -4;
				groupFuradeira.rotation.x = 1;
			}
		}else{
			if(contFuradeira<1 && NaGarra == "furadeira"){
				// Solta furadeira
				stateArm=1; // Move garra e braco.
				NaGarra="";
				contFuradeira=50;
				garraRobo.remove(groupFuradeira);
				addFuradeiraMae();
			}
		}
	//}
	stateLink = {action:"", state:""};
}


function funTratarMina(indexCristal){
	console.log("funTratarMina(indexCristal="+indexCristal+")");
	if(dados.mina[platorAtual][indexCristal].state=="on"){
		console.log("Mina pronta para extracao.");
		if(NaGarra==""){
			funSound(2,"cristal.m4a"); // Tocar uma mbarulinho cristal.
			stateArm=1; // MOve garra e braco.
			NaGarra = "cristal"; //colocar cristal na garra
			NaGarraCristal = indexCristal; // Usando o cristal 0
		}
	}else{
		//stateLink.state=="off"
		if(NaGarra == "furadeira"){
			funSound(2,"MeteoroBateu.mp3"); // Tocar uma musiquinha no inicio.
			console.log("Furar mina." + indexCristal)
			dados.mina[platorAtual][indexCristal].state="on";
			objMina[indexCristal].minafechada.position.y = objMina[indexCristal].minafechada.position.y-50;
			objCristal[indexCristal].position.y = dados.mina[platorAtual][indexCristal].y;
			stateArm=1;
			//dados.link[7+indexCristal].state="on";
		}else{
			console.log("Precisa da broca para furar.");
		}
	}
	stateLink = {action:"", state:""};
}



function moverCamera(positX, positY, positZ, AfastarZ) {
	let AfastarY =AfastarZ
	if(stareNave!==0){
		AfastarZ=600;
		AfastarY=150;
	}else if(AfastarZ<250){
		AfastarZ=110;
		AfastarY=50;
	}else{
		AfastarZ=300;
		AfastarY=250;
	}
	camera.position.x = positX;//-20;
	camera.position.y = positY+AfastarY // 50  //80 //; //55
	camera.position.z = positZ+AfastarZ //200;
	camera.lookAt(positX, positY+30, positZ);
}


function moverPersonagem() {
	let varDirecao = stateDirecao;
	let velocidade;
	let positgarra = {x:0,z:0};
    if(stateEnergiaRobo<2){
		velocidade = 1;
		funSound(2, "semBateria.wav"); // Tocar uma musiquinha no inicio.
	}else if(stateEnergiaRobo<20){
		velocidade = 4;
	}else if(stateEnergiaRobo<40){
		velocidade = 7;
	}else{
		velocidade = 9;
	}
	if(stateArm>0){
		//Não faz nada
		stateDirecao="";
	}else if (stateDirecao=="<-"){
		groupRobo.rotation.y = 1.5708; //1.5708radianos==90graus
		groupRobo.position.x = groupRobo.position.x-velocidade;
		if(colideForObjetos()){
			groupRobo.position.x = groupRobo.position.x+velocidade;
		}
		positgarra.x = groupRobo.position.x -18;
		positgarra.z = groupRobo.position.z;
    } else if (stateDirecao=="->"){
		groupRobo.rotation.y = -1.5708; // 1.5708radianos==90graus
		groupRobo.position.x = groupRobo.position.x+velocidade;
		if(colideForObjetos()){
			groupRobo.position.x = groupRobo.position.x-velocidade;
		}
		positgarra.x = groupRobo.position.x +18;
		positgarra.z = groupRobo.position.z;
    } else if (stateDirecao=="re"){
		groupRobo.rotation.y = 3.1416; // 3.1416radiano==180graus
		groupRobo.position.z = groupRobo.position.z+velocidade;
		if(colideForObjetos()){
			groupRobo.position.z = groupRobo.position.z-velocidade;
		}
		positgarra.x = groupRobo.position.x;
		positgarra.z = groupRobo.position.z +18;
    } else if (stateDirecao=="frente"){
		groupRobo.rotation.y = 0; //ok
		groupRobo.position.z = groupRobo.position.z-velocidade;
		if(colideForObjetos()){
			groupRobo.position.z = groupRobo.position.z+velocidade;
		}
		positgarra.x = groupRobo.position.x;
		positgarra.z = groupRobo.position.z -18;
	} else if (stateDirecao=="subir"){
		groupRobo.position.y = groupRobo.position.y+velocidade;
		if(colideForObjetos()){
			groupRobo.position.y = groupRobo.position.y-velocidade;
		}
    } else if (stateDirecao=="descer"){
		groupRobo.position.y = groupRobo.position.y-velocidade;
		if(colideForObjetos()){
			groupRobo.position.y = groupRobo.position.y+velocidade;
		}
    } else if (stateDirecao=="pula"){
		groupRobo.position.y = groupRobo.position.y+velocidade;
		if(colideForObjetos()){
			groupRobo.position.y = groupRobo.position.y-velocidade;
		}
    }
	if(stateDirecao!==""){
		if(NaGarra=="cristal" && stateArm==0){
			//mover cristal na garra. Usar index Cristal [NaGarraCristal]
			console.log("movendo cristal na garra "+NaGarraCristal);
			objCristal[NaGarraCristal].position.y=groupRobo.position.y+20;
			objCristal[NaGarraCristal].position.x=positgarra.x;
			objCristal[NaGarraCristal].position.z=positgarra.z; 
		}else if(NaGarra=="bateria" && stateArm==0){
			//mover bateria na garra. Usar index Cristal [NaGarraCristal]
			console.log("movendo Bateria na garra "+NaGarraBateria);
			baterias.garra[NaGarraBateria].position.y=groupRobo.position.y+20;
			baterias.garra[NaGarraBateria].position.x=positgarra.x;
			baterias.garra[NaGarraBateria].position.z=positgarra.z; 
		}else if(NaGarra=="furadeira"){
			//groupFuradeira.position.y = groupRobo.position.y+20;
			//groupFuradeira.position.x = positgarra.x;
			//groupFuradeira.position.z = positgarra.z;
		}
		console.log("x="+groupRobo.position.x+",y="+groupRobo.position.y+",z="+groupRobo.position.z);
		energiaRobo.position.x = groupRobo.position.x;
		energiaRobo.position.y = groupRobo.position.y+60;
		energiaRobo.position.z = groupRobo.position.z;
		energiaRobo2.position.x = groupRobo.position.x;
		energiaRobo2.position.y = groupRobo.position.y+60;
		energiaRobo2.position.z = groupRobo.position.z;
		animaEnergia();
		GirarRodas();
		moverCamera(groupRobo.position.x, groupRobo.position.y, groupRobo.position.z, groupRobo.position.z-groupNaveMae.position.z);
		stateDirecao="";
	}
}

function animaGerador(){
	//Converes.length
	for(let i=0; i<3; i++){

		if(Converes[i].state>=600){
			console.log("// bateria pronta.")
			Converes[i].state=2;
			//Voltar cristal para mina?
			objCristal[Converes[i].cristal].position.y = dados.mina[platorAtual][Converes[i].cristal].y;
			objCristal[Converes[i].cristal].position.x = dados.mina[platorAtual][Converes[i].cristal].x;
			objCristal[Converes[i].cristal].position.z = dados.mina[platorAtual][Converes[i].cristal].z;
			objCristal[Converes[i].cristal].scale.z = 20;
			objCristal[Converes[i].cristal].scale.x = 20;
			Converes[i].cristal=""; // zerar informação sobre o cristal no Conversor/Gerador
			//encolhjer cristal. Qual é o cristal?
			baterias.garra[i].position.y = -80; //-1,0,1,2;
			baterias.garra[i].scale.y = 10;
		}else if(Converes[i].state>=300){
			console.log("// Convertendo Cristal("+Converes[i].cristal+") em energia")
			Converes[i].state=Converes[i].state+1; //(100 passos)
			objCristal[Converes[i].cristal].position.y = objCristal[Converes[i].cristal].position.y-0.2
			objCristal[Converes[i].cristal].scale.z = objCristal[Converes[i].cristal].scale.z-0.1
			objCristal[Converes[i].cristal].scale.x = objCristal[Converes[i].cristal].scale.x-0.1
			baterias.garra[i].position.y = baterias.garra[i].position.y+0.1 //-1,0,1,2;
			//baterias.garra[i].scale.y = 0.5; //1
			//encolhjer cristal. Qual é o cristal?
		}else if(Converes[i].state>=200){
			console.log("//Libretado para uso.")
			Converes[i].position.y = 1;
			Converes[i].scale.y = 1//1;
			Converes[i].state=1; 
		}else if(Converes[i].state>=175){
			console.log("// Ligando conversor de energia.")
			Converes[i].position.y = 0 // (-2,-1,0,1)
			Converes[i].scale.y = 0.8;    // (0.5, 0.6, 0.7, 0.8, 0.9, 1)
			Converes[i].state=Converes[i].state+1; //(100passos)
		}else if(Converes[i].state>=125){
			console.log("// Ligando conversor de energia.")
			Converes[i].position.y = -1 // (-2,-1,0,1)
			Converes[i].scale.y = 0.7;    // (0.5, 0.6, 0.7, 0.8, 0.9, 1)
			Converes[i].state=Converes[i].state+1; //(100passos)
		}else if(Converes[i].state>=100){
			console.log("// Ligando conversor de energia.")
			Converes[i].position.y = -2 // (-2,-1,0,1)
			Converes[i].scale.y = 0.5;    // (0.5, 0.6, 0.7, 0.8, 0.9, 1)
			Converes[i].state=Converes[i].state+1; //(100passos)

		}
		
	}
	
}

function animaEnergia(){
	if(stateEnergiaRobo>0 && stateLink.action!=="cabine"){
		stateEnergiaRobo=stateEnergiaRobo-0.01;
	}
	energiaRobo2.scale.set(stateEnergiaRobo, 5, 1);
	let tempdesloca = 25 - (stateEnergiaRobo/2) //stateEnergiaRobo valor 50 até 0
	energiaRobo2.position.x = groupRobo.position.x-tempdesloca;
}


function initGetHTML(){
	idAudioAmbiente = document.getElementById("idAudioAmbiente"); // Usar arquivos .m4a
	idAudioFX = document.getElementById("idAudioFX"); // Usar arquivos .m4a
	//Janelas HTML
	idInterface = document.getElementById("idInterface");
	idWinLoad = document.getElementById("idWinLoad");
	idWinMenu = document.getElementById("idWinMenu");
	idWinCredito = document.getElementById("idWinCredito");
	idWinPlanetas = document.getElementById("idWinPlanetas");
	idWinIntro2 = document.getElementById("idWinIntro2");
	idWinIntro1 = document.getElementById("idWinIntro1");
	idWinMaquina = document.getElementById("idWinMaquina");
	idButInit = document.getElementById("idButInit");
	idButVoltar = document.getElementById("idButVoltar");
	idSpanPlaneta = document.getElementById("idSpanPlaneta");
}



function init(){

	initGetHTML()
	
	dados = {solid:[],link:[], mina:[]};
	dados.mina = funDadosMina();
	if(window.innerWidth>window.innerHeight){
		largura = window.innerWidth-5;
	}else{
		largura = window.innerHeight-5 //window.innerWidth/100*80;
	}
	altura = largura/2;
	scene = new THREE.Scene(); // Criar a cena onde tudo sera incluido
	scene.background = new THREE.Color(0x000005); // Definir uma cor de fundo.

	initMaterial(); // Carregar materiais
	initLight(); // Carregar Luz
	initCamera(); // Carregar Camera
	initRender();

	//document.body.appendChild( renderer.domElement );
	DivCanvasID.appendChild( renderer.domElement );
	document.addEventListener("keydown", keyPush);
	renderer.domElement.style.height=altura+"px"; //"100%"; 
	renderer.domElement.style.width=largura+"px"; //"100%";

	idInterface.style.height=altura+"px"; //"100%"; 
	idInterface.style.width=largura+"px"; //"100%";
	//dados.solid = funDadosSolid(1);
	//dados.link = funDadosLinks(1);

	initCeu()
	initGLTFNaveMae(); // Carregar geometrias - totalCarga==1
	initGLTFRobo(); // Carregar geometrias - totalCarga==2
	initGLTFTerreno(); // Carregar geometrias - totalCarga==3
	initGLTFCristais(); // Carregar geometrias - totalCarga==4
	initGLTFAcessorios(); // Carregar geometrias - totalCarga==5
	//initGLTFGenerico();
	//cargaCompleta() //5
};


//init()

</script>
</body>
</html>